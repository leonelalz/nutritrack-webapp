import{a as se,b as pe,c as ge,d as ue,e as _e,f as Ce,g as fe,h as xe}from"./chunk-OYIIR6RP.js";import{a as me,b as ce,c as le}from"./chunk-R7JGX3WZ.js";import{a as re}from"./chunk-5EP6LFYW.js";import{a as X,b as ee,c as te,d as ie,e as ne,f as ae,j as oe}from"./chunk-M6FO7V5J.js";import{a as de}from"./chunk-FFVTBA3Y.js";import{c as H}from"./chunk-IZFSTANS.js";import"./chunk-3ERIXVYS.js";import{l as W,n as q,o as U}from"./chunk-IEOKP2HD.js";import{A as j,z as B}from"./chunk-7NAIVTKU.js";import{a as Q}from"./chunk-AVXLCIQN.js";import{c as K,g as Y,j as Z,w as J}from"./chunk-GRSFFSFU.js";import"./chunk-Q53AFBXZ.js";import{b as $,d as z,e as L}from"./chunk-ONQJZTIX.js";import"./chunk-N5IZLMDI.js";import{Bb as h,Cc as V,Db as l,Ec as R,Ma as c,Rb as r,Sa as P,Sb as v,Tb as M,Ub as N,Vb as w,Wb as D,Xb as O,Za as k,ba as p,bb as T,ca as g,ec as G,lb as F,ma as u,mb as _,nb as C,pb as S,qb as E,rb as f,sb as o,tb as n,ub as A,zb as b}from"./chunk-D6HZ3QFW.js";import{c as I}from"./chunk-2VMXMS7J.js";var Me=(d,i)=>i.numeroDia,Se=(d,i)=>i.tempId||i.idComida,Ee=(d,i)=>i.id;function we(d,i){d&1&&(o(0,"div",6)(1,"mat-icon"),r(2,"hourglass_empty"),n(),o(3,"p"),r(4,"Cargando comidas..."),n()())}function De(d,i){d&1&&(o(0,"div",16)(1,"mat-icon"),r(2,"restaurant_menu"),n(),o(3,"p"),r(4,"No hay comidas programadas para este d\xEDa"),n()())}function Oe(d,i){if(d&1&&(o(0,"span",25),r(1),n()),d&2){let e=l().$implicit;c(),M("",e.comida.calorias," kcal")}}function ye(d,i){if(d&1&&(o(0,"span",25),r(1),n()),d&2){let e=l().$implicit;c(),M("",e.comida.tiempoPreparacion," min")}}function Ie(d,i){if(d&1){let e=b();o(0,"div",29)(1,"mat-form-field",30)(2,"mat-label"),r(3,"Notas"),n(),o(4,"textarea",31),O("ngModelChange",function(a){p(e);let m=l().$implicit;return D(m.notas,a)||(m.notas=a),g(a)}),n()()()}if(d&2){let e=l().$implicit;c(4),w("ngModel",e.notas)}}function ke(d,i){if(d&1){let e=b();o(0,"div",17)(1,"div",20)(2,"span",21),r(3),n(),o(4,"div",22)(5,"h4"),r(6),n(),o(7,"div",23)(8,"span",24),r(9),n(),_(10,Oe,2,1,"span",25),_(11,ye,2,1,"span",25),n()(),o(12,"div",26)(13,"button",27),h("click",function(){let a=p(e).$index,m=l().$implicit,s=l(2);return g(s.toggleDetalles(m.numeroDia,a))}),o(14,"mat-icon"),r(15),n()(),o(16,"button",28),h("click",function(){let a=p(e).$index,m=l().$implicit,s=l(2);return g(s.eliminarComidaDia(m.numeroDia,a))}),o(17,"mat-icon"),r(18,"delete"),n()()()(),_(19,Ie,5,1,"div",29),n()}if(d&2){let e=i.$implicit,t=i.$index,a=l(3);c(3),v(t+1),c(3),v(e.comida.nombre),c(3),v(a.formatearTipoComida(e.tipoComida)),c(),C(e.comida.calorias?10:-1),c(),C(e.comida.tiempoPreparacion?11:-1),c(2),F("aria-label",e.mostrarDetalles?"Ocultar detalles":"Mostrar detalles"),c(2),v(e.mostrarDetalles?"expand_less":"expand_more"),c(4),C(e.mostrarDetalles?19:-1)}}function Te(d,i){if(d&1&&(o(0,"mat-option",33),r(1),n()),d&2){let e=i.$implicit;f("value",e.id),c(),N(" ",e.nombre," (",e.nutricionTotal&&e.nutricionTotal.energiaTotal||0," kcal) ")}}function Fe(d,i){if(d&1){let e=b();o(0,"div",18)(1,"h4"),r(2,"Agregar Comida"),n(),o(3,"mat-form-field",30)(4,"mat-label"),r(5,"Seleccionar Comida"),n(),o(6,"mat-select",32),O("ngModelChange",function(a){p(e);let m=l(3);return D(m.comidaSeleccionadaId,a)||(m.comidaSeleccionadaId=a),g(a)}),o(7,"mat-option",33),r(8,"-- Seleccionar --"),n(),S(9,Te,2,3,"mat-option",33,Ee),n()(),o(11,"mat-form-field",30)(12,"mat-label"),r(13,"Tipo de Comida"),n(),o(14,"mat-select",32),O("ngModelChange",function(a){p(e);let m=l(3);return D(m.tipoComidaSeleccionado,a)||(m.tipoComidaSeleccionado=a),g(a)}),o(15,"mat-option",34),r(16,"Desayuno"),n(),o(17,"mat-option",35),r(18,"Almuerzo"),n(),o(19,"mat-option",36),r(20,"Cena"),n(),o(21,"mat-option",37),r(22,"Snack"),n(),o(23,"mat-option",38),r(24,"Merienda"),n(),o(25,"mat-option",39),r(26,"Colaci\xF3n"),n()()(),o(27,"div",40)(28,"button",41),h("click",function(){p(e);let a=l(3);return g(a.cancelarAgregarComida())}),r(29," Cancelar "),n(),o(30,"button",42),h("click",function(){p(e);let a=l().$implicit,m=l(2);return g(m.agregarComidaADia(a.numeroDia))}),o(31,"mat-icon"),r(32,"add"),n(),r(33," Agregar "),n()()()}if(d&2){let e=l(3);c(6),w("ngModel",e.comidaSeleccionadaId),c(),f("value",null),c(2),E(e.comidasDisponibles()),c(5),w("ngModel",e.tipoComidaSeleccionado),c(16),f("disabled",!e.comidaSeleccionadaId||!e.tipoComidaSeleccionado)}}function Ae(d,i){if(d&1){let e=b();o(0,"button",43),h("click",function(){p(e);let a=l().$implicit,m=l(2);return g(m.abrirFormAgregarComida(a.numeroDia))}),o(1,"mat-icon"),r(2,"add"),n(),r(3," Agregar Comida "),n()}}function Ne(d,i){if(d&1&&(o(0,"mat-expansion-panel",10)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon"),r(4,"event"),n(),o(5,"strong"),r(6),n(),A(7,"span",14),n()(),o(8,"div",15),_(9,De,5,0,"div",16),S(10,ke,20,8,"div",17,Se),_(12,Fe,34,4,"div",18),_(13,Ae,4,0,"button",19),n()()),d&2){let e=i.$implicit,t=l(2);f("expanded",!0),c(6),v(e.diaLabel),c(),f("matBadge",e.comidas.length),c(2),C(e.comidas.length===0?9:-1),c(),E(e.comidas),c(2),C(t.mostrarFormAgregarComida()&&t.diaSeleccionado()===e.numeroDia?12:-1),c(),C(!t.mostrarFormAgregarComida()||t.diaSeleccionado()!==e.numeroDia?13:-1)}}function Ge(d,i){if(d&1&&(o(0,"p",44),r(1),n()),d&2){let e=l(2);c(),M("",e.totalComidas()," comida(s) en total")}}function Ve(d,i){if(d&1){let e=b();o(0,"div",7)(1,"div",8)(2,"mat-card",9)(3,"mat-card-header")(4,"mat-card-title")(5,"mat-icon"),r(6,"calendar_today"),n(),r(7," Planificaci\xF3n por D\xEDas "),n()(),o(8,"mat-card-content"),S(9,Ne,14,6,"mat-expansion-panel",10,Me),n()(),o(11,"div",11)(12,"button",12),h("click",function(){p(e);let a=l();return g(a.guardarPlan())}),o(13,"mat-icon"),r(14,"save"),n(),r(15),n(),T(16,Ge,2,1,"p",13),n()()()}if(d&2){let e=l();c(9),E(e.diasPlan()),c(3),f("disabled",e.guardando()||!e.hayComidas()),c(3),M(" ",e.guardando()?"Guardando...":"Guardar Plan Completo"," "),c(),f("ngIf",e.totalComidas()>0)}}var he=class d{constructor(i,e,t,a,m){this.route=i;this.router=e;this.planService=t;this.comidaService=a;this.notificationService=m}planId;nombrePlan=u("");duracionDias=u(7);cargando=u(!0);guardando=u(!1);comidasDisponibles=u([]);diasPlan=u([]);mostrarFormAgregarComida=u(!1);diaSeleccionado=u(null);comidaSeleccionadaId=null;tipoComidaSeleccionado=null;totalComidas=G(()=>this.diasPlan().reduce((i,e)=>i+e.comidas.length,0));ngOnInit(){this.planId=Number(this.route.snapshot.paramMap.get("id")),this.cargarDatos()}cargarDatos(){this.cargando.set(!0),Promise.all([this.cargarPlan(),this.cargarComidasDisponibles()]).finally(()=>{this.cargando.set(!1)})}cargarPlan(){return I(this,null,function*(){return new Promise((i,e)=>{this.planService.obtenerPlanPorId(this.planId).subscribe({next:t=>{t.success&&t.data&&(this.nombrePlan.set(t.data.nombre),this.duracionDias.set(t.data.duracionDias),this.inicializarDias(t.data.duracionDias),this.cargarComidasExistentes()),i()},error:t=>{this.notificationService.showError("Error al cargar plan"),this.router.navigate(["/admin/planes"]),e(t)}})})})}inicializarDias(i){let e=[];for(let t=1;t<=i;t++)e.push({numeroDia:t,diaLabel:`D\xEDa ${t}`,comidas:[]});this.diasPlan.set(e)}cargarComidasExistentes(){this.planService.obtenerDiasPlan(this.planId).subscribe({next:i=>{if(i.success&&i.data&&i.data.length>0){let e=this.diasPlan();i.data.forEach(t=>{let a=e.find(m=>m.numeroDia===t.numeroDia);if(a){let m={idComida:t.comida.id,numeroDia:t.numeroDia,tipoComida:t.tipoComida,notas:t.notas,comida:{id:t.comida.id,nombre:t.comida.nombre,tipo:t.comida.tipo,tiempoPreparacion:t.comida.tiempoPreparacion,calorias:t.comida.calorias},tempId:`existing-${t.id}`,mostrarDetalles:!1};a.comidas.push(m)}}),this.diasPlan.set([...e]),this.notificationService.showSuccess(`${i.data.length} comida(s) cargada(s)`)}},error:i=>{console.error("Error al cargar comidas existentes:",i)}})}cargarComidasDisponibles(){return I(this,null,function*(){return new Promise((i,e)=>{this.comidaService.listar(0,100).subscribe({next:t=>{t.success&&t.data&&this.comidasDisponibles.set(t.data.content||[]),i()},error:t=>{this.notificationService.showError("Error al cargar comidas"),e(t)}})})})}abrirFormAgregarComida(i){this.mostrarFormAgregarComida.set(!0),this.diaSeleccionado.set(i),this.comidaSeleccionadaId=null,this.tipoComidaSeleccionado=null}cancelarAgregarComida(){this.mostrarFormAgregarComida.set(!1),this.diaSeleccionado.set(null),this.comidaSeleccionadaId=null,this.tipoComidaSeleccionado=null}agregarComidaADia(i){if(!this.comidaSeleccionadaId||!this.tipoComidaSeleccionado)return;let e=this.comidasDisponibles().find(x=>x.id===this.comidaSeleccionadaId);if(!e)return;let t=this.diasPlan(),a=t.find(x=>x.numeroDia===i);if(!a)return;let m={id:e.id,nombre:e.nombre,tipo:e.tipoComida,tiempoPreparacion:e.tiempoPreparacionMinutos||0,calorias:e.nutricionTotal?.energiaTotal||0},s={tempId:`temp-${Date.now()}-${Math.random()}`,idComida:e.id,numeroDia:i,tipoComida:this.tipoComidaSeleccionado,comida:m,mostrarDetalles:!1};a.comidas.push(s),this.diasPlan.set([...t]),this.cancelarAgregarComida(),this.notificationService.showSuccess(`Comida agregada a ${a.diaLabel}`)}eliminarComidaDia(i,e){let t=this.diasPlan(),a=t.find(m=>m.numeroDia===i);a&&(a.comidas.splice(e,1),this.diasPlan.set([...t]))}toggleDetalles(i,e){let t=this.diasPlan(),a=t.find(m=>m.numeroDia===i);a&&a.comidas[e]&&(a.comidas[e].mostrarDetalles=!a.comidas[e].mostrarDetalles,this.diasPlan.set([...t]))}hayComidas(){return this.totalComidas()>0}guardarPlan(){if(!this.hayComidas()){this.notificationService.showError("Agrega al menos una comida");return}this.guardando.set(!0),this.planService.obtenerDiasPlan(this.planId).subscribe({next:i=>{let e=i.data||[],t=[];e.forEach(a=>{let m=new Promise((s,x)=>{this.planService.eliminarDiaDelPlan(this.planId,a.id).subscribe({next:()=>s(!0),error:y=>x(y)})});t.push(m)}),Promise.all(t).then(()=>{let a=[];return this.diasPlan().forEach(m=>{m.comidas.forEach(s=>{let x={numeroDia:s.numeroDia,tipoComida:s.tipoComida,idComida:s.idComida,notas:s.notas},y=new Promise((Pe,be)=>{this.planService.agregarDiaAlPlan(this.planId,x).subscribe({next:()=>Pe(!0),error:ve=>be(ve)})});a.push(y)})}),Promise.all(a)}).then(()=>{this.notificationService.showSuccess("Plan guardado correctamente"),this.router.navigate(["/admin/planes"])}).catch(a=>{console.error("Error al guardar:",a),this.notificationService.showError(a.error?.message||"Error al guardar el plan")}).finally(()=>{this.guardando.set(!1)})},error:i=>{console.error("Error al obtener comidas:",i),this.notificationService.showError("Error al guardar el plan"),this.guardando.set(!1)}})}formatearTipoComida(i){return{DESAYUNO:"Desayuno",ALMUERZO:"Almuerzo",CENA:"Cena",SNACK:"Snack",MERIENDA:"Merienda",COLACION:"Colaci\xF3n",PRE_ENTRENAMIENTO:"Pre-Entrenamiento",POST_ENTRENAMIENTO:"Post-Entrenamiento"}[i]||i}static \u0275fac=function(e){return new(e||d)(P($),P(z),P(re),P(de),P(Q))};static \u0275cmp=k({type:d,selectors:[["app-gestionar-comidas-plan"]],decls:15,vars:2,consts:[[1,"page-container"],[1,"page-header"],[1,"header-content"],[1,"page-title"],[1,"page-subtitle"],["mat-raised-button","","routerLink","/admin/planes","color","primary"],[1,"loading-state"],[1,"layout-single"],[1,"planificacion-dias"],[1,"planning-card"],[1,"dia-panel",3,"expanded"],[1,"action-buttons"],["mat-raised-button","","color","primary",1,"btn-save",3,"click","disabled"],["class","save-hint",4,"ngIf"],["matBadgeColor","accent",1,"comidas-count",3,"matBadge"],[1,"day-content"],[1,"empty-day"],[1,"comida-en-dia"],[1,"form-agregar-comida"],["mat-raised-button","","color","accent",1,"btn-add-comida"],[1,"comida-compact-view"],[1,"orden-numero"],[1,"comida-info-compact"],[1,"comida-quick-info"],[1,"badge","badge-tipo"],[1,"quick-detail"],[1,"compact-actions"],["mat-icon-button","",3,"click"],["mat-icon-button","","color","warn",3,"click"],[1,"comida-detalles"],["appearance","outline",1,"full-width"],["matInput","","rows","2","placeholder","Ej: Servir caliente, agregar lim\xF3n",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],[3,"value"],["value","DESAYUNO"],["value","ALMUERZO"],["value","CENA"],["value","SNACK"],["value","MERIENDA"],["value","COLACION"],[1,"form-actions"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","accent",1,"btn-add-comida",3,"click"],[1,"save-hint"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"mat-icon"),r(5,"restaurant_menu"),n(),r(6),n(),o(7,"p",4),r(8,"Agrega y configura las comidas para cada d\xEDa del plan"),n()(),o(9,"button",5)(10,"mat-icon"),r(11,"arrow_back"),n(),r(12," Volver "),n()(),_(13,we,5,0,"div",6)(14,Ve,17,3,"div",7),n()),e&2&&(c(6),M(" Gestionar Comidas - ",t.nombrePlan()," "),c(7),C(t.cargando()?13:14))},dependencies:[R,V,L,J,K,Y,Z,j,B,U,q,W,le,ce,oe,ae,me,pe,se,H,ne,X,te,ie,ee,Ce,ge,ue,_e,xe,fe],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem;background:#f8f9fa;min-height:100vh}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;gap:2rem}.header-content[_ngcontent-%COMP%]{flex:1}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin:0 0 .5rem;font-size:1.75rem;font-weight:700;color:#2d3748}.page-title[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:2rem;width:2rem;height:2rem;color:#f59e0b}.page-subtitle[_ngcontent-%COMP%]{margin:0;color:#718096;font-size:1rem}.layout-single[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.planning-card[_ngcontent-%COMP%]{width:100%;max-height:calc(100vh - 200px);overflow-y:auto}.planning-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:1rem!important}.dia-panel[_ngcontent-%COMP%]{margin-bottom:1rem!important;box-shadow:0 1px 3px #0000001a!important}.dia-panel[_ngcontent-%COMP%]   mat-panel-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1.1rem}.comidas-count[_ngcontent-%COMP%]{margin-left:auto}.day-content[_ngcontent-%COMP%]{padding:1rem 0}.empty-day[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#a0aec0}.empty-day[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:2.5rem;width:2.5rem;height:2.5rem;margin-bottom:.5rem}.comida-en-dia[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:8px;margin-bottom:.75rem;box-shadow:0 1px 3px #0000001a;overflow:hidden;transition:all .2s}.comida-en-dia[_ngcontent-%COMP%]:hover{box-shadow:0 2px 8px #00000026;border-color:#cbd5e0}.comida-compact-view[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.875rem 1rem;min-height:60px}.orden-numero[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.875rem;flex-shrink:0}.comida-info-compact[_ngcontent-%COMP%]{flex:1;min-width:0;overflow:hidden}.comida-info-compact[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .375rem;font-size:.938rem;color:#2d3748;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.comida-quick-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}.quick-detail[_ngcontent-%COMP%]{padding:.188rem .5rem;background:#f7fafc;color:#4a5568;border-radius:4px;font-size:.75rem;font-weight:600;border:1px solid #e2e8f0;white-space:nowrap}.badge[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:600}.badge-tipo[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.form-agregar-comida[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #e2e8f0;border-radius:8px;padding:1rem;margin-bottom:1rem}.form-agregar-comida[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:#2d3748}.form-agregar-comida[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:.75rem}.form-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:flex-end}.btn-add-comida[_ngcontent-%COMP%]{width:100%;margin-bottom:1rem}.compact-actions[_ngcontent-%COMP%]{display:flex;gap:.25rem;flex-shrink:0;margin-left:auto}.compact-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:32px;height:32px;padding:0}.comida-detalles[_ngcontent-%COMP%]{padding:0 1rem 1rem 4.5rem;background:#f8f9fa;border-top:1px solid #e2e8f0}.full-width[_ngcontent-%COMP%]{width:100%}.action-buttons[_ngcontent-%COMP%]{margin-top:2rem;text-align:center}.btn-save[_ngcontent-%COMP%]{padding:.75rem 3rem;font-size:1rem;font-weight:600}.save-hint[_ngcontent-%COMP%]{margin-top:.75rem;color:#718096;font-size:.875rem}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000001a}.loading-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem;color:#cbd5e0;margin-bottom:1rem;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}@media (max-width: 768px){.comida-compact-view[_ngcontent-%COMP%]{flex-wrap:wrap}.comida-info-compact[_ngcontent-%COMP%]{width:100%}.comida-detalles[_ngcontent-%COMP%]{padding-left:1rem}}"]})};export{he as GestionarComidasPlanComponent};
