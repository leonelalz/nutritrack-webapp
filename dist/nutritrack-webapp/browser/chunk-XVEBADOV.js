import{a as Z}from"./chunk-5EP6LFYW.js";import{A as w,z as I}from"./chunk-7NAIVTKU.js";import{a as K}from"./chunk-AVXLCIQN.js";import{c as k,e as l,g as F,h as R,k as z,l as T,m as V,o as j,p as $,q as G,r as U,s as q,t as L,v as Y,x as B}from"./chunk-GRSFFSFU.js";import"./chunk-Q53AFBXZ.js";import{b as N,d as y,e as A}from"./chunk-ONQJZTIX.js";import"./chunk-N5IZLMDI.js";import{Bb as D,Db as p,Ec as O,Ma as r,Rb as a,Sa as u,Sb as M,Tb as c,Za as E,ba as v,ca as b,ma as s,mb as g,nb as f,pb as x,qb as P,rb as _,sb as n,tb as e,ub as C,zb as h}from"./chunk-D6HZ3QFW.js";import"./chunk-2VMXMS7J.js";var J=(o,i)=>i.dia,Q=(o,i)=>i.id;function W(o,i){o&1&&(n(0,"div",6),a(1,"Cargando configuraci\xF3n..."),e())}function X(o,i){o&1&&(n(0,"div",24)(1,"p"),a(2,"No hay comidas asignadas a\xFAn. Comienza agregando comidas para cada d\xEDa."),e()())}function ee(o,i){if(o&1&&(n(0,"span"),a(1),e()),o&2){let t=p().$implicit;r(),c("",t.comida.calorias," kcal")}}function ie(o,i){if(o&1){let t=h();n(0,"div",29)(1,"div",30)(2,"span",31),a(3),e(),n(4,"div",32)(5,"strong"),a(6),e(),n(7,"div",33)(8,"span",34),a(9),e(),g(10,ee,2,1,"span"),e()()(),n(11,"button",35),D("click",function(){let m=v(t).$implicit,S=p(3);return b(S.eliminarDia(m.id))}),a(12," Eliminar "),e()()}if(o&2){let t=i.$implicit,d=p().$implicit,m=p(2);r(3),c("",d.comidas.indexOf(t)+1,"."),r(3),M(t.comida.nombre),r(3),M(m.formatearTipoComida(t.tipoComida)),r(),f(t.comida.calorias?10:-1)}}function te(o,i){if(o&1&&(n(0,"div",25)(1,"div",26)(2,"h3"),a(3),e(),n(4,"span",27),a(5),e()(),n(6,"div",28),x(7,ie,13,4,"div",29,Q),e()()),o&2){let t=i.$implicit;r(3),c("D\xEDa ",t.dia),r(2),c("",t.comidas.length," comida(s)"),r(2),P(t.comidas)}}function ne(o,i){if(o&1){let t=h();n(0,"div",7)(1,"div",8)(2,"h2"),a(3,"Agregar Comida al Plan"),e(),n(4,"form",9),D("ngSubmit",function(){v(t);let m=p();return b(m.agregarDia())}),n(5,"div",10)(6,"div",11)(7,"label"),a(8,"D\xEDa"),e(),C(9,"input",12),n(10,"small"),a(11),e()(),n(12,"div",11)(13,"label"),a(14,"ID Comida"),e(),C(15,"input",13),n(16,"small"),a(17,"ID de comida existente"),e()(),n(18,"div",11)(19,"label"),a(20,"Tipo"),e(),n(21,"select",14)(22,"option",15),a(23,"Desayuno"),e(),n(24,"option",16),a(25,"Almuerzo"),e(),n(26,"option",17),a(27,"Cena"),e(),n(28,"option",18),a(29,"Snack"),e(),n(30,"option",19),a(31,"Merienda"),e()()(),n(32,"div",11)(33,"label"),a(34,"Porciones"),e(),C(35,"input",20),e(),n(36,"div",11)(37,"label"),a(38,"Orden"),e(),C(39,"input",21),e(),n(40,"button",22),a(41),e()()()(),n(42,"div",23)(43,"h2"),a(44,"D\xEDas Configurados"),e(),g(45,X,3,0,"div",24),x(46,te,9,2,"div",25,J),e()()}if(o&2){let t=p();r(4),_("formGroup",t.formulario),r(5),_("max",t.duracionDias()),r(2),c("De 1 a ",t.duracionDias()),r(29),_("disabled",t.formulario.invalid||t.guardando()),r(),c(" ",t.guardando()?"Agregando...":"+ Agregar"," "),r(4),f(t.diasAgrupados().length===0?45:-1),r(),P(t.diasAgrupados())}}var H=class o{constructor(i,t,d,m,S){this.fb=i;this.route=t;this.router=d;this.planService=m;this.notificationService=S;this.inicializarFormulario()}formulario;planId;nombrePlan=s("");duracionDias=s(7);cargando=s(!0);guardando=s(!1);dias=s([]);diasAgrupados=s([]);ngOnInit(){this.planId=Number(this.route.snapshot.paramMap.get("id")),this.cargarPlan()}inicializarFormulario(){this.formulario=this.fb.group({numeroDia:[1,[l.required,l.min(1)]],comidaId:["",[l.required,l.min(1)]],tipoComida:["DESAYUNO",l.required],porcionesRecomendadas:[1,[l.required,l.min(.5)]],orden:[1,[l.required,l.min(1)]]})}cargarPlan(){this.planService.obtenerPlanPorId(this.planId).subscribe({next:i=>{i.success&&i.data&&(this.nombrePlan.set(i.data.nombre),this.duracionDias.set(i.data.duracionDias),this.dias.set(i.data.dias||[]),this.agruparDias(),this.cargando.set(!1))},error:()=>{this.notificationService.showError("Error al cargar plan"),this.router.navigate(["/admin/planes"])}})}agruparDias(){let i=new Map;this.dias().forEach(d=>{i.has(d.numeroDia)||i.set(d.numeroDia,[]),i.get(d.numeroDia).push(d)});let t=Array.from(i.entries()).map(([d,m])=>({dia:d,comidas:m})).sort((d,m)=>d.dia-m.dia);this.diasAgrupados.set(t)}agregarDia(){if(this.formulario.invalid){this.formulario.markAllAsTouched();return}this.guardando.set(!0),this.planService.agregarDiaAlPlan(this.planId,this.formulario.value).subscribe({next:i=>{this.guardando.set(!1),i.success&&(this.notificationService.showSuccess("Comida agregada al d\xEDa"),this.formulario.reset({numeroDia:1,tipoComida:"DESAYUNO",porcionesRecomendadas:1,orden:1}),this.cargarPlan())},error:i=>{this.guardando.set(!1),this.notificationService.showError(i.error?.message||"Error al agregar comida")}})}eliminarDia(i){confirm("\xBFEliminar esta comida del plan?")&&this.planService.eliminarDiaDelPlan(this.planId,i).subscribe({next:t=>{t.success&&(this.notificationService.showSuccess("Comida eliminada"),this.cargarPlan())},error:()=>{this.notificationService.showError("Error al eliminar")}})}formatearTipoComida(i){return{DESAYUNO:"Desayuno",ALMUERZO:"Almuerzo",CENA:"Cena",SNACK:"Snack",MERIENDA:"Merienda"}[i]||i}static \u0275fac=function(t){return new(t||o)(u(Y),u(N),u(y),u(Z),u(K))};static \u0275cmp=E({type:o,selectors:[["app-configurar-dias-plan"]],decls:13,vars:3,consts:[[1,"configurar-dias-container"],[1,"page-header"],[1,"header-content"],[1,"page-title"],[1,"page-subtitle"],["routerLink","/admin/planes",1,"btn-link"],[1,"loading"],[1,"content"],[1,"add-section"],[1,"add-form",3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group"],["type","number","formControlName","numeroDia","min","1",3,"max"],["type","number","formControlName","comidaId","min","1"],["formControlName","tipoComida"],["value","DESAYUNO"],["value","ALMUERZO"],["value","CENA"],["value","SNACK"],["value","MERIENDA"],["type","number","formControlName","porcionesRecomendadas","min","0.5","step","0.5"],["type","number","formControlName","orden","min","1"],["type","submit",1,"btn-primary",3,"disabled"],[1,"dias-section"],[1,"empty-state"],[1,"dia-card"],[1,"dia-header"],[1,"comidas-count"],[1,"comidas-list"],[1,"comida-item"],[1,"comida-info"],[1,"orden"],[1,"comida-details"],[1,"comida-meta"],[1,"badge"],[1,"btn-delete",3,"click"]],template:function(t,d){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"mat-icon"),a(5,"calendar_today"),e(),a(6),e(),n(7,"p",4),a(8,"Asigna comidas a cada d\xEDa del plan nutricional"),e()(),n(9,"button",5),a(10,"\u2190 Volver a planes"),e()(),g(11,W,2,0,"div",6),g(12,ne,48,6,"div",7),e()),t&2&&(r(6),c(" Configurar D\xEDas - ",d.nombrePlan()," "),r(5),f(d.cargando()?11:-1),r(),f(d.cargando()?-1:12))},dependencies:[O,A,B,z,G,U,k,T,$,F,R,L,q,V,j,w,I],styles:[".configurar-dias-container[_ngcontent-%COMP%]{padding:2rem;max-width:1200px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}h1[_ngcontent-%COMP%]{font-size:2rem;color:#2d3748;margin:0}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:#667eea;font-weight:600;cursor:pointer}.add-section[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:12px;margin-bottom:2rem;box-shadow:0 2px 8px #0000001a}.add-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;margin-bottom:1rem}.add-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr) auto;gap:1rem;align-items:end}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;margin-bottom:.25rem;color:#4a5568}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #e2e8f0;border-radius:6px;font-size:.875rem}.form-group[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:.75rem;color:#718096;margin-top:.25rem}.dias-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;margin-bottom:1rem}.dia-card[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1rem;box-shadow:0 2px 8px #0000001a}.dia-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:.75rem;border-bottom:2px solid #e2e8f0}.dia-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.125rem;color:#2d3748;margin:0}.comidas-count[_ngcontent-%COMP%]{background:#edf2f7;padding:.25rem .75rem;border-radius:20px;font-size:.875rem;color:#4a5568}.comidas-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.comida-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#f7fafc;border-radius:8px}.comida-info[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:start;flex:1}.orden[_ngcontent-%COMP%]{font-weight:700;color:#667eea;font-size:1.125rem}.comida-details[_ngcontent-%COMP%]{flex:1}.comida-details[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:#2d3748;margin-bottom:.25rem}.comida-meta[_ngcontent-%COMP%]{display:flex;gap:1rem;font-size:.875rem;color:#718096}.badge[_ngcontent-%COMP%]{background:#e6fffa;color:#234e52;padding:.125rem .5rem;border-radius:12px;font-weight:600;font-size:.75rem}.btn-primary[_ngcontent-%COMP%]{padding:.5rem 1rem;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-size:.875rem}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-delete[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#fc8181;color:#fff;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-size:.875rem}.btn-delete[_ngcontent-%COMP%]:hover{background:#f56565}.loading[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#718096}"]})};export{H as ConfigurarDiasPlanComponent};
