import{a as c}from"./chunk-Q53AFBXZ.js";import{d as g}from"./chunk-ONQJZTIX.js";import{Lc as u,Q as l,T as o,Y as s,ma as n}from"./chunk-D6HZ3QFW.js";var i=class r{setItem(e,t){try{let a=JSON.stringify(t);localStorage.setItem(e,a)}catch(a){console.error("Error saving to localStorage",a)}}getItem(e){try{let t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.error("Error reading from localStorage",t),null}}removeItem(e){try{localStorage.removeItem(e)}catch(t){console.error("Error removing from localStorage",t)}}clear(){try{localStorage.clear()}catch(e){console.error("Error clearing localStorage",e)}}static \u0275fac=function(t){return new(t||r)};static \u0275prov=o({token:r,factory:r.\u0275fac,providedIn:"root"})};var p=class r{http=s(u);storage=s(i);router=s(g);apiUrl=`${c.apiUrl}/auth`;_currentUser=n(null);_isAuthenticated=n(!1);_token=n(null);currentUser=this._currentUser.asReadonly();isAuthenticated=this._isAuthenticated.asReadonly();token=this._token.asReadonly();constructor(){this.loadAuthData()}login(e){return this.http.post(`${this.apiUrl}/login`,e).pipe(l(t=>{console.log("LOGIN RAW RESPONSE:",t),this.saveAuthData(t.data)}))}register(e){return this.http.post(`${this.apiUrl}/registro`,e).pipe(l(t=>{this.saveAuthData(t)}))}logout(){this.storage.removeItem("token"),this.storage.removeItem("user"),this._currentUser.set(null),this._isAuthenticated.set(!1),this._token.set(null),this.router.navigate(["/login"])}saveAuthData(e){this.storage.setItem("token",e.token),this._token.set(e.token);let t={id:e.userId,email:e.email,nombre:e.nombre,apellido:e.apellido,role:e.role,active:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};this.storage.setItem("user",t),this._currentUser.set(t),this._isAuthenticated.set(!0)}loadAuthData(){let e=this.storage.getItem("token"),t=this.storage.getItem("user");e&&t&&(this._token.set(e),this._currentUser.set(t),this._isAuthenticated.set(!0))}isAdmin(){return this._currentUser()?.role==="ROLE_ADMIN"}getToken(){return this._token()}get currentUserValue(){return this._currentUser()}static \u0275fac=function(t){return new(t||r)};static \u0275prov=o({token:r,factory:r.\u0275fac,providedIn:"root"})};export{p as a};
