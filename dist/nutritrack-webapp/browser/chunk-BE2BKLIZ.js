import{a as te}from"./chunk-MNU2WE5Z.js";import{a as ee}from"./chunk-5EP6LFYW.js";import{A as L,z as V}from"./chunk-7NAIVTKU.js";import{a as Z}from"./chunk-AVXLCIQN.js";import{c as R,e as l,g as A,h as B,k as $,l as Y,m as H,n as J,o as K,s as Q,t as U,v as W,x as X}from"./chunk-GRSFFSFU.js";import"./chunk-Q53AFBXZ.js";import{d as z,e as G}from"./chunk-ONQJZTIX.js";import"./chunk-N5IZLMDI.js";import{Bb as P,Db as x,Ec as I,Ma as c,Pb as E,Rb as n,Sa as g,Sb as j,Tb as T,Za as k,ba as y,ca as D,ma as f,mb as s,nb as u,pb as N,qb as w,rb as h,sb as e,tb as t,ub as d,zb as F}from"./chunk-D6HZ3QFW.js";import{a as M,b as q}from"./chunk-2VMXMS7J.js";var ie=(a,r)=>r.id;function re(a,r){a&1&&(e(0,"span",12),n(1,"El nombre es obligatorio"),t())}function oe(a,r){a&1&&(e(0,"span",12),n(1,"El nombre debe tener al menos 5 caracteres"),t())}function ae(a,r){a&1&&(e(0,"span",12),n(1,"La descripci\xF3n es obligatoria"),t())}function le(a,r){a&1&&(e(0,"span",12),n(1,"La duraci\xF3n es obligatoria"),t())}function ce(a,r){a&1&&(e(0,"span",12),n(1,"La duraci\xF3n m\xEDnima es 1 d\xEDa"),t())}function de(a,r){a&1&&(e(0,"div",30),n(1,"Cargando etiquetas..."),t())}function me(a,r){if(a&1){let o=F();e(0,"label",35)(1,"input",36),P("change",function(){let m=y(o).$implicit,p=x(2);return D(p.toggleEtiqueta(m.id))}),t(),e(2,"span",37),n(3),t()()}if(a&2){let o=r.$implicit,i=x(2);c(),h("checked",i.etiquetasSeleccionadas().includes(o.id)),c(2),j(o.nombre)}}function se(a,r){if(a&1&&(e(0,"div",31),N(1,me,4,2,"label",35,ie),t()),a&2){let o=x();c(),w(o.etiquetas())}}var ne=class a{constructor(r,o,i,m,p){this.fb=r;this.planService=o;this.etiquetaService=i;this.notificationService=m;this.router=p;this.inicializarFormulario()}formulario;guardando=f(!1);cargandoEtiquetas=f(!1);etiquetas=f([]);etiquetasSeleccionadas=f([]);ngOnInit(){this.cargarEtiquetas()}inicializarFormulario(){this.formulario=this.fb.group({nombre:["",[l.required,l.minLength(5)]],descripcion:["",[l.required,l.minLength(10)]],duracionDias:[7,[l.required,l.min(1),l.max(365)]],objetivo:this.fb.group({caloriasObjetivo:[2e3,[l.required,l.min(1e3),l.max(5e3)]],proteinasObjetivo:[150,[l.required,l.min(0)]],carbohidratosObjetivo:[200,[l.required,l.min(0)]],grasasObjetivo:[70,[l.required,l.min(0)]],descripcion:["",l.required]})})}cargarEtiquetas(){this.cargandoEtiquetas.set(!0),this.etiquetaService.obtenerTodas().subscribe({next:r=>{this.cargandoEtiquetas.set(!1),r.success&&r.data&&this.etiquetas.set(r.data)},error:()=>{this.cargandoEtiquetas.set(!1),this.notificationService.showError("Error al cargar etiquetas")}})}toggleEtiqueta(r){let o=this.etiquetasSeleccionadas();o.includes(r)?this.etiquetasSeleccionadas.set(o.filter(i=>i!==r)):this.etiquetasSeleccionadas.set([...o,r])}guardar(){if(this.formulario.invalid){this.formulario.markAllAsTouched(),this.notificationService.showError("Por favor completa todos los campos requeridos");return}this.guardando.set(!0);let r=q(M({},this.formulario.value),{etiquetaIds:this.etiquetasSeleccionadas()});this.planService.crearPlan(r).subscribe({next:o=>{this.guardando.set(!1),o.success&&(this.notificationService.showSuccess("Plan creado exitosamente"),this.router.navigate(["/admin/planes"]))},error:o=>{this.guardando.set(!1),o.status===409?this.notificationService.showError("Ya existe un plan con ese nombre (RN11)"):o.status===400?this.notificationService.showError(o.error.message||"Datos inv\xE1lidos"):this.notificationService.showError("Error al crear plan")}})}static \u0275fac=function(o){return new(o||a)(g(W),g(ee),g(te),g(Z),g(z))};static \u0275cmp=k({type:a,selectors:[["app-crear-plan"]],decls:90,vars:16,consts:[[1,"crear-plan-container"],[1,"page-header"],[1,"header-content"],[1,"page-title"],[1,"page-subtitle"],["routerLink","/admin/planes",1,"btn-link"],[1,"plan-form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"form-group"],["for","nombre"],[1,"required"],["id","nombre","type","text","formControlName","nombre","placeholder","Ej: Plan P\xE9rdida de Peso - 7 d\xEDas"],[1,"error-text"],[1,"help-text"],["for","descripcion"],["id","descripcion","formControlName","descripcion","rows","4","placeholder","Describe los beneficios y caracter\xEDsticas del plan..."],["for","duracionDias"],["id","duracionDias","type","number","formControlName","duracionDias","min","1","max","365"],["formGroupName","objetivo"],["id","descripcion","formControlName","descripcion","rows","2","placeholder","Ej: D\xE9ficit cal\xF3rico moderado con alta prote\xEDna"],[1,"form-row"],["for","calorias"],["id","calorias","type","number","formControlName","caloriasObjetivo","min","1000","max","5000","step","50"],["for","proteinas"],["id","proteinas","type","number","formControlName","proteinasObjetivo","min","0","step","5"],["for","carbohidratos"],["id","carbohidratos","type","number","formControlName","carbohidratosObjetivo","min","0","step","5"],["for","grasas"],["id","grasas","type","number","formControlName","grasasObjetivo","min","0","step","5"],[1,"section-description"],[1,"loading"],[1,"etiquetas-grid"],[1,"form-actions"],["type","button","routerLink","/admin/planes",1,"btn-secondary"],["type","submit",1,"btn-primary",3,"disabled"],[1,"checkbox-card"],["type","checkbox",3,"change","checked"],[1,"checkbox-label"]],template:function(o,i){if(o&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"mat-icon"),n(5,"restaurant_menu"),t(),n(6," Crear Plan Nutricional "),t(),e(7,"p",4),n(8,"Crea un nuevo plan nutricional personalizado"),t()(),e(9,"button",5),n(10,"\u2190 Volver a planes"),t()(),e(11,"form",6),P("ngSubmit",function(){return i.guardar()}),e(12,"div",7)(13,"h2"),n(14,"Informaci\xF3n B\xE1sica"),t(),e(15,"div",8)(16,"label",9),n(17,"Nombre del Plan "),e(18,"span",10),n(19,"*"),t()(),d(20,"input",11),s(21,re,2,0,"span",12),s(22,oe,2,0,"span",12),e(23,"small",13),n(24,"El nombre debe ser \xFAnico (RN11)"),t()(),e(25,"div",8)(26,"label",14),n(27,"Descripci\xF3n "),e(28,"span",10),n(29,"*"),t()(),d(30,"textarea",15),s(31,ae,2,0,"span",12),t(),e(32,"div",8)(33,"label",16),n(34,"Duraci\xF3n (d\xEDas) "),e(35,"span",10),n(36,"*"),t()(),d(37,"input",17),s(38,le,2,0,"span",12),s(39,ce,2,0,"span",12),t()(),e(40,"div",7)(41,"h2"),n(42,"Objetivos Nutricionales"),t(),e(43,"div",18)(44,"div",8)(45,"label",14),n(46,"Descripci\xF3n del Objetivo "),e(47,"span",10),n(48,"*"),t()(),d(49,"textarea",19),t(),e(50,"div",20)(51,"div",8)(52,"label",21),n(53,"Calor\xEDas Objetivo (kcal) "),e(54,"span",10),n(55,"*"),t()(),d(56,"input",22),t(),e(57,"div",8)(58,"label",23),n(59,"Prote\xEDnas (g) "),e(60,"span",10),n(61,"*"),t()(),d(62,"input",24),t()(),e(63,"div",20)(64,"div",8)(65,"label",25),n(66,"Carbohidratos (g) "),e(67,"span",10),n(68,"*"),t()(),d(69,"input",26),t(),e(70,"div",8)(71,"label",27),n(72,"Grasas (g) "),e(73,"span",10),n(74,"*"),t()(),d(75,"input",28),t()()()(),e(76,"div",7)(77,"h2"),n(78,"Etiquetas"),t(),e(79,"p",29),n(80,"Selecciona las etiquetas que aplican a este plan"),t(),s(81,de,2,0,"div",30),s(82,se,3,0,"div",31),e(83,"small",13),n(84,"Las etiquetas deben existir previamente (RN12)"),t()(),e(85,"div",32)(86,"button",33),n(87," Cancelar "),t(),e(88,"button",34),n(89),t()()()()),o&2){let m,p,S,b,C,v,_,O;c(11),h("formGroup",i.formulario),c(9),E("error",((m=i.formulario.get("nombre"))==null?null:m.invalid)&&((m=i.formulario.get("nombre"))==null?null:m.touched)),c(),u((p=i.formulario.get("nombre"))!=null&&p.hasError("required")&&((p=i.formulario.get("nombre"))!=null&&p.touched)?21:-1),c(),u((S=i.formulario.get("nombre"))!=null&&S.hasError("minlength")?22:-1),c(8),E("error",((b=i.formulario.get("descripcion"))==null?null:b.invalid)&&((b=i.formulario.get("descripcion"))==null?null:b.touched)),c(),u((C=i.formulario.get("descripcion"))!=null&&C.hasError("required")&&((C=i.formulario.get("descripcion"))!=null&&C.touched)?31:-1),c(6),E("error",((v=i.formulario.get("duracionDias"))==null?null:v.invalid)&&((v=i.formulario.get("duracionDias"))==null?null:v.touched)),c(),u((_=i.formulario.get("duracionDias"))!=null&&_.hasError("required")&&((_=i.formulario.get("duracionDias"))!=null&&_.touched)?38:-1),c(),u((O=i.formulario.get("duracionDias"))!=null&&O.hasError("min")?39:-1),c(42),u(i.cargandoEtiquetas()?81:-1),c(),u(!i.cargandoEtiquetas()&&i.etiquetas().length>0?82:-1),c(6),h("disabled",i.formulario.invalid||i.guardando()),c(),T(" ",i.guardando()?"Guardando...":"Crear Plan"," ")}},dependencies:[I,G,X,$,R,Y,A,B,U,Q,H,K,J,L,V],styles:[".crear-plan-container[_ngcontent-%COMP%]{padding:2rem;max-width:900px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}h1[_ngcontent-%COMP%]{font-size:2rem;color:#2d3748;margin:0}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:#667eea;font-weight:600;cursor:pointer;font-size:1rem}.btn-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.plan-form[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:2rem;box-shadow:0 2px 8px #0000001a}.form-section[_ngcontent-%COMP%]{margin-bottom:2rem;padding-bottom:2rem;border-bottom:1px solid #e2e8f0}.form-section[_ngcontent-%COMP%]:last-of-type{border-bottom:none}.form-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;color:#2d3748;margin-bottom:.5rem}.section-description[_ngcontent-%COMP%]{color:#718096;margin-bottom:1rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}label[_ngcontent-%COMP%]{display:block;font-weight:600;color:#4a5568;margin-bottom:.5rem}.required[_ngcontent-%COMP%]{color:#e53e3e}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #e2e8f0;border-radius:8px;font-size:1rem;transition:border-color .2s}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}input.error[_ngcontent-%COMP%], select.error[_ngcontent-%COMP%], textarea.error[_ngcontent-%COMP%]{border-color:#fc8181}.error-text[_ngcontent-%COMP%]{display:block;color:#e53e3e;font-size:.875rem;margin-top:.25rem}.help-text[_ngcontent-%COMP%]{display:block;color:#718096;font-size:.875rem;margin-top:.25rem}.etiquetas-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:.75rem}.checkbox-card[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.75rem;border:2px solid #e2e8f0;border-radius:8px;cursor:pointer;transition:all .2s}.checkbox-card[_ngcontent-%COMP%]:hover{border-color:#667eea;background:#f7fafc}.checkbox-card[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:auto;margin-right:.5rem}.checkbox-card[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .checkbox-label[_ngcontent-%COMP%]{font-weight:600;color:#667eea}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;padding-top:2rem}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{padding:.75rem 2rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all .2s;font-size:1rem}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background:#edf2f7;color:#4a5568}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e2e8f0}.loading[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#718096}"]})};export{ne as CrearPlanComponent};
