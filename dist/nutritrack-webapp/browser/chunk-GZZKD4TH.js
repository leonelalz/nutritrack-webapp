import{a as d}from"./chunk-6ULEJF3H.js";import{O as g,Rc as C,U as O,Y as U,c as m,n as b}from"./chunk-N5FZ7NRP.js";import{a as f,b as T}from"./chunk-2VMXMS7J.js";var I=class y{constructor(e){this.http=e}usuarioUrl=`${d.apiUrl}/usuario`;obtenerPlanesActivos(){return this.http.get(`${this.usuarioUrl}/planes/activos`)}obtenerPlanActivo(){return this.http.get(`${this.usuarioUrl}/planes/activo`)}obtenerHistorialPlanes(){return this.http.get(`${this.usuarioUrl}/planes`)}obtenerTodosLosPlanesDeUsuario(){return this.obtenerHistorialPlanes()}obtenerRutinasActivas(){return this.http.get(`${this.usuarioUrl}/rutinas/activas`)}obtenerRutinaActiva(){return this.http.get(`${this.usuarioUrl}/rutinas/activa`)}obtenerHistorialRutinas(){return this.http.get(`${this.usuarioUrl}/rutinas`)}obtenerTodasLasRutinasDeUsuario(){return this.obtenerHistorialRutinas()}activarPlan(e){return this.http.post(`${this.usuarioUrl}/planes/activar`,e)}pausarPlan(e){return this.http.patch(`${this.usuarioUrl}/planes/${e}/pausar`,{})}reanudarPlan(e){return this.http.patch(`${this.usuarioUrl}/planes/${e}/reanudar`,{})}completarPlan(e){return this.http.patch(`${this.usuarioUrl}/planes/${e}/completar`,{})}cancelarPlan(e){return this.http.patch(`${this.usuarioUrl}/planes/${e}/cancelar`,{})}activarRutina(e){return this.http.post(`${this.usuarioUrl}/rutinas/activar`,e)}pausarRutina(e){return this.http.patch(`${this.usuarioUrl}/rutinas/${e}/pausar`,{})}reanudarRutina(e){return this.http.patch(`${this.usuarioUrl}/rutinas/${e}/reanudar`,{})}completarRutina(e){return this.http.patch(`${this.usuarioUrl}/rutinas/${e}/completar`,{})}cancelarRutina(e){return this.http.patch(`${this.usuarioUrl}/rutinas/${e}/cancelar`,{})}obtenerComidasProgramadasHoy(){return this.obtenerPlanesActivos().pipe(g(e=>{if(!e.success||!e.data||e.data.length===0)return new m(r=>{r.next({success:!0,data:[],message:"No hay planes activos"}),r.complete()});let s=e.data[0],c=s.plan?.id||s.planId,p=new Date(s.fechaInicio),o=new Date().getTime()-p.getTime(),a=Math.floor(o/(1e3*60*60*24))+1;return a<=0?new m(r=>{r.next({success:!0,data:[],message:"El plan a\xFAn no ha comenzado"}),r.complete()}):this.http.get(`${d.apiUrl}/planes/${c}/dias/${a}`).pipe(b(r=>{let u=(r.data||[]).map(i=>({id:i.id,numeroDia:i.numeroDia,tipoComida:i.tipoComida,comidaId:i.comida?.id,comidaNombre:i.comida?.nombre,notas:i.notas,calorias:i.comida?.nutricionTotal?.energiaTotal||i.comida?.calorias||0,proteinas:i.comida?.nutricionTotal?.proteinasTotales||i.comida?.proteinas||0,carbohidratos:i.comida?.nutricionTotal?.carbohidratosTotales||i.comida?.carbohidratos||0,grasas:i.comida?.nutricionTotal?.grasasTotales||i.comida?.grasas||0,comida:i.comida?{id:i.comida.id,nombre:i.comida.nombre,tipoComida:i.comida.tipoComida,descripcion:i.comida.descripcion,instrucciones:i.comida.instrucciones,tiempoPreparacionMinutos:i.comida.tiempoPreparacionMinutos,porciones:i.comida.porciones,ingredientes:i.comida.ingredientes||[],calorias:i.comida.nutricionTotal?.energiaTotal||0,proteinas:i.comida.nutricionTotal?.proteinasTotales||0,carbohidratos:i.comida.nutricionTotal?.carbohidratosTotales||0,grasas:i.comida.nutricionTotal?.grasasTotales||0,nutricionTotal:i.comida.nutricionTotal}:null,completada:!1,porciones:1}));return{success:!0,data:u,message:`${u.length} comida(s) para hoy (d\xEDa ${a})`}}))}))}obtenerEjerciciosProgramadosHoy(){return this.obtenerRutinasActivas().pipe(g(e=>{if(!e.success||!e.data||e.data.length===0)return new m(n=>{n.next({success:!0,data:[],message:"No hay rutinas activas"}),n.complete()});let s=e.data[0],c=s.rutina?.id||s.rutinaId,p=s.rutina?.patronSemanas||s.patronSemanas||1,l=new Date(s.fechaInicio),o=new Date,A=o.getTime()-l.getTime(),a=Math.floor(A/(1e3*60*60*24));if(a<0)return new m(n=>{n.next({success:!0,data:[],message:"La rutina a\xFAn no ha comenzado"}),n.complete()});let r=Math.floor(a/7)+1,u=(r-1)%p+1,i=o.getDay(),R=i===0?7:i;return console.log("\u{1F4C5} Calculando ejercicios de hoy:",{fechaInicio:l.toISOString().split("T")[0],hoy:o.toISOString().split("T")[0],diffDays:a,semanaAbsoluta:r,patronSemanas:p,semanaBase:u,diaSemanaJS:i,diaSemanaAPI:R}),this.http.get(`${d.apiUrl}/rutinas/${c}/ejercicios`).pipe(b(n=>{if(!n.success||!n.data)return{success:!0,data:[],message:"No hay ejercicios"};console.log("\u{1F3CB}\uFE0F Ejercicios de la rutina:",n.data);let v=n.data.filter(t=>{let h=t.semanaBase===u,$=t.diaSemana===R;return console.log(`  - ${t.ejercicio?.nombre}: semana ${t.semanaBase}=${u}? ${h}, dia ${t.diaSemana}=${R}? ${$}`),h&&$}).sort((t,h)=>(t.orden||0)-(h.orden||0)).map(t=>T(f({},t),{ejercicioNombre:t.ejercicio?.nombre||"Ejercicio",ejercicioDescripcion:t.ejercicio?.descripcion||"",grupoMuscular:t.ejercicio?.grupoMuscular||"",tipoEjercicio:t.ejercicio?.tipoEjercicio||""}));return console.log("\u2705 Ejercicios para hoy:",v.length),{success:!0,data:v,message:`${v.length} ejercicio(s) para hoy`}}))}))}registrarComidaConsumida(e){return this.http.post(`${this.usuarioUrl}/registros/comidas`,e)}registrarEjercicioCompletado(e){return this.http.post(`${this.usuarioUrl}/registros/ejercicios`,e)}obtenerRutinaHoyConEstado(){return this.http.get(`${this.usuarioUrl}/registros/rutina/hoy`)}eliminarRegistroEjercicio(e){return this.http.delete(`${this.usuarioUrl}/registros/ejercicios/${e}`)}obtenerProgresoSemanal(e){return e?this.http.get(`${this.usuarioUrl}/registros/ejercicios/progreso/semanal`,{params:{fecha:e}}):this.http.get(`${this.usuarioUrl}/registros/ejercicios/progreso/semanal`)}obtenerPlanHoyConEstado(){return this.http.get(`${this.usuarioUrl}/registros/plan/hoy`)}obtenerPlanDiaConEstado(e){return this.http.get(`${this.usuarioUrl}/registros/plan/dia`,{params:{fecha:e}})}eliminarRegistroComida(e){return this.http.delete(`${this.usuarioUrl}/registros/comidas/${e}`)}obtenerCalendarioComidas(e,s){return this.http.get(`${this.usuarioUrl}/registros/comidas/calendario`,{params:{fechaInicio:e,fechaFin:s}})}obtenerCalendarioSemanal(e){let s=`${this.usuarioUrl}/registros/comidas/calendario/semana`;return e?this.http.get(s,{params:{fecha:e}}):this.http.get(s)}obtenerCalendarioMensual(e){let s=`${this.usuarioUrl}/registros/comidas/calendario/mes`;return e?this.http.get(s,{params:{fecha:e}}):this.http.get(s)}obtenerProgresoSemanalComidas(e){let s=`${this.usuarioUrl}/registros/comidas/progreso/semanal`;return e?this.http.get(s,{params:{fecha:e}}):this.http.get(s)}obtenerProgresoSemanalEjercicios(e){let s=`${this.usuarioUrl}/registros/ejercicios/progreso/semanal`;return e?this.http.get(s,{params:{fecha:e}}):this.http.get(s)}registrarComidaExtra(e){return this.http.post(`${this.usuarioUrl}/registros/comidas/extra`,e)}obtenerHistorialComidas(e,s){return this.http.get(`${this.usuarioUrl}/registros/comidas/historial`,{params:{fechaInicio:e,fechaFin:s}})}obtenerComidasPorDia(e,s){return this.http.get(`${d.apiUrl}/planes/${e}/dias/${s}`)}obtenerTodasLasComidasDelPlan(){return this.obtenerPlanesActivos().pipe(g(e=>{if(!e.success||!e.data||e.data.length===0)return new m(o=>{o.next({success:!0,data:{comidas:[],planInfo:null},message:"No hay planes activos"}),o.complete()});let s=e.data[0],c=s.plan?.id||s.planId,p=s.plan?.duracionDias||s.planDuracionDias||7,l=s.fechaInicio;return this.http.get(`${d.apiUrl}/planes/${c}/dias`).pipe(b(o=>({success:!0,message:"Comidas del plan cargadas",data:{comidas:(o.data||[]).map(a=>({id:a.id,numeroDia:a.numeroDia,tipoComida:a.tipoComida,comidaId:a.comida?.id,comidaNombre:a.comida?.nombre,notas:a.notas,calorias:a.comida?.nutricionTotal?.energiaTotal||a.comida?.calorias||0,proteinas:a.comida?.nutricionTotal?.proteinasTotales||a.comida?.proteinas||0,carbohidratos:a.comida?.nutricionTotal?.carbohidratosTotales||a.comida?.carbohidratos||0,grasas:a.comida?.nutricionTotal?.grasasTotales||a.comida?.grasas||0,comida:{id:a.comida?.id,nombre:a.comida?.nombre,tipoComida:a.comida?.tipoComida,descripcion:a.comida?.descripcion,instrucciones:a.comida?.instrucciones,ingredientes:a.comida?.ingredientes||[],calorias:a.comida?.nutricionTotal?.energiaTotal||0,proteinas:a.comida?.nutricionTotal?.proteinasTotales||0,carbohidratos:a.comida?.nutricionTotal?.carbohidratosTotales||0,grasas:a.comida?.nutricionTotal?.grasasTotales||0}})),planInfo:{planId:c,fechaInicio:l,diasTotales:p,planNombre:s.plan?.nombre||s.planNombre}}})))}))}static \u0275fac=function(s){return new(s||y)(U(C))};static \u0275prov=O({token:y,factory:y.\u0275fac,providedIn:"root"})};export{I as a};
