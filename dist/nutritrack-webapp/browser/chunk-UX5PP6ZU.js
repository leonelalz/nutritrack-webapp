import{a as H}from"./chunk-ZDVLMOYB.js";import{a as Z}from"./chunk-RAUW4CRJ.js";import{A as w,z as A}from"./chunk-6AXQUQX5.js";import{c as T,e as c,g as z,h as k,k as R,l as F,m as V,o as j,p as $,q as G,r as U,s as q,t as L,v as Y,x as B}from"./chunk-M75YHKAC.js";import{a as K}from"./chunk-F5B3K5RO.js";import"./chunk-6ULEJF3H.js";import{a as N,c as y,d as I}from"./chunk-LBN5CU62.js";import"./chunk-NZVHEJ25.js";import{Bb as D,Db as M,Fb as l,Kc as O,Na as d,Ta as u,Tb as o,Ub as x,Vb as p,_a as E,ca as h,da as P,na as s,nb as g,ob as f,rb as b,sb as _,tb as C,ub as n,vb as t,wb as v}from"./chunk-N5FZ7NRP.js";import"./chunk-2VMXMS7J.js";var Q=(a,e)=>e.id,W=(a,e)=>e.dia;function X(a,e){a&1&&(n(0,"div",6),o(1,"Cargando configuraci\xF3n..."),t())}function ee(a,e){if(a&1&&(n(0,"option",15),o(1),t()),a&2){let i=e.$implicit,r=l(2);C("value",i.nombre),d(),x(r.formatearTipoComida(i.nombre))}}function ie(a,e){a&1&&(n(0,"div",20)(1,"p"),o(2,"No hay comidas asignadas a\xFAn. Comienza agregando comidas para cada d\xEDa."),t()())}function te(a,e){if(a&1&&(n(0,"span"),o(1),t()),a&2){let i=l().$implicit;d(),p("",i.comida.calorias," kcal")}}function ne(a,e){if(a&1){let i=D();n(0,"div",25)(1,"div",26)(2,"span",27),o(3),t(),n(4,"div",28)(5,"strong"),o(6),t(),n(7,"div",29)(8,"span",30),o(9),t(),g(10,te,2,1,"span"),t()()(),n(11,"button",31),M("click",function(){let m=h(i).$implicit,S=l(3);return P(S.eliminarDia(m.id))}),o(12," Eliminar "),t()()}if(a&2){let i=e.$implicit,r=l().$implicit,m=l(2);d(3),p("",r.comidas.indexOf(i)+1,"."),d(3),x(i.comida.nombre),d(3),x(m.formatearTipoComida(i.tipoComida)),d(),f(i.comida.calorias?10:-1)}}function oe(a,e){if(a&1&&(n(0,"div",21)(1,"div",22)(2,"h3"),o(3),t(),n(4,"span",23),o(5),t()(),n(6,"div",24),b(7,ne,13,4,"div",25,Q),t()()),a&2){let i=e.$implicit;d(3),p("D\xEDa ",i.dia),d(2),p("",i.comidas.length," comida(s)"),d(2),_(i.comidas)}}function ae(a,e){if(a&1){let i=D();n(0,"div",7)(1,"div",8)(2,"h2"),o(3,"Agregar Comida al Plan"),t(),n(4,"form",9),M("ngSubmit",function(){h(i);let m=l();return P(m.agregarDia())}),n(5,"div",10)(6,"div",11)(7,"label"),o(8,"D\xEDa"),t(),v(9,"input",12),n(10,"small"),o(11),t()(),n(12,"div",11)(13,"label"),o(14,"ID Comida"),t(),v(15,"input",13),n(16,"small"),o(17,"ID de comida existente"),t()(),n(18,"div",11)(19,"label"),o(20,"Tipo"),t(),n(21,"select",14),b(22,ee,2,2,"option",15,Q),t()(),n(24,"div",11)(25,"label"),o(26,"Porciones"),t(),v(27,"input",16),t(),n(28,"div",11)(29,"label"),o(30,"Orden"),t(),v(31,"input",17),t(),n(32,"button",18),o(33),t()()()(),n(34,"div",19)(35,"h2"),o(36,"D\xEDas Configurados"),t(),g(37,ie,3,0,"div",20),b(38,oe,9,2,"div",21,W),t()()}if(a&2){let i=l();d(4),C("formGroup",i.formulario),d(5),C("max",i.duracionDias()),d(2),p("De 1 a ",i.duracionDias()),d(11),_(i.tiposComida()),d(10),C("disabled",i.formulario.invalid||i.guardando()),d(),p(" ",i.guardando()?"Agregando...":"+ Agregar"," "),d(4),f(i.diasAgrupados().length===0?37:-1),d(),_(i.diasAgrupados())}}var J=class a{constructor(e,i,r,m,S,re){this.fb=e;this.route=i;this.router=r;this.planService=m;this.notificationService=S;this.tipoComidaService=re;this.inicializarFormulario()}formulario;planId;nombrePlan=s("");duracionDias=s(7);cargando=s(!0);guardando=s(!1);dias=s([]);diasAgrupados=s([]);tiposComida=s([]);ngOnInit(){this.planId=Number(this.route.snapshot.paramMap.get("id")),this.cargarTiposComida(),this.cargarPlan()}cargarTiposComida(){this.tipoComidaService.obtenerTiposComida().subscribe({next:e=>{if(e.success&&e.data){let i=e.data.filter(r=>r.activo).sort((r,m)=>r.ordenVisualizacion-m.ordenVisualizacion);this.tiposComida.set(i)}},error:()=>{this.tiposComida.set([{id:1,nombre:"DESAYUNO",descripcion:"",ordenVisualizacion:1,activo:!0},{id:2,nombre:"ALMUERZO",descripcion:"",ordenVisualizacion:2,activo:!0},{id:3,nombre:"CENA",descripcion:"",ordenVisualizacion:3,activo:!0},{id:4,nombre:"SNACK",descripcion:"",ordenVisualizacion:4,activo:!0},{id:5,nombre:"MERIENDA",descripcion:"",ordenVisualizacion:5,activo:!0}])}})}inicializarFormulario(){this.formulario=this.fb.group({numeroDia:[1,[c.required,c.min(1)]],comidaId:["",[c.required,c.min(1)]],tipoComidaNombre:["DESAYUNO",c.required],porcionesRecomendadas:[1,[c.required,c.min(.5)]],orden:[1,[c.required,c.min(1)]]})}cargarPlan(){this.planService.obtenerPlanPorId(this.planId).subscribe({next:e=>{e.success&&e.data&&(this.nombrePlan.set(e.data.nombre),this.duracionDias.set(e.data.duracionDias),this.dias.set(e.data.dias||[]),this.agruparDias(),this.cargando.set(!1))},error:()=>{this.notificationService.showError("Error al cargar plan"),this.router.navigate(["/admin/planes"])}})}agruparDias(){let e=new Map;this.dias().forEach(r=>{e.has(r.numeroDia)||e.set(r.numeroDia,[]),e.get(r.numeroDia).push(r)});let i=Array.from(e.entries()).map(([r,m])=>({dia:r,comidas:m})).sort((r,m)=>r.dia-m.dia);this.diasAgrupados.set(i)}agregarDia(){if(this.formulario.invalid){this.formulario.markAllAsTouched();return}this.guardando.set(!0),this.planService.agregarDiaAlPlan(this.planId,this.formulario.value).subscribe({next:e=>{this.guardando.set(!1),e.success&&(this.notificationService.showSuccess("Comida agregada al d\xEDa"),this.formulario.reset({numeroDia:1,tipoComidaNombre:"DESAYUNO",porcionesRecomendadas:1,orden:1}),this.cargarPlan())},error:e=>{this.guardando.set(!1),this.notificationService.showError(e.error?.message||"Error al agregar comida")}})}eliminarDia(e){confirm("\xBFEliminar esta comida del plan?")&&this.planService.eliminarDiaDelPlan(this.planId,e).subscribe({next:i=>{i.success&&(this.notificationService.showSuccess("Comida eliminada"),this.cargarPlan())},error:()=>{this.notificationService.showError("Error al eliminar")}})}formatearTipoComida(e){return{DESAYUNO:"Desayuno",ALMUERZO:"Almuerzo",CENA:"Cena",SNACK:"Snack",MERIENDA:"Merienda"}[e]||e}static \u0275fac=function(i){return new(i||a)(u(Y),u(N),u(y),u(Z),u(K),u(H))};static \u0275cmp=E({type:a,selectors:[["app-configurar-dias-plan"]],decls:13,vars:3,consts:[[1,"configurar-dias-container"],[1,"page-header"],[1,"header-content"],[1,"page-title"],[1,"page-subtitle"],["routerLink","/admin/planes",1,"btn-link"],[1,"loading"],[1,"content"],[1,"add-section"],[1,"add-form",3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group"],["type","number","formControlName","numeroDia","min","1",3,"max"],["type","number","formControlName","comidaId","min","1"],["formControlName","tipoComidaNombre"],[3,"value"],["type","number","formControlName","porcionesRecomendadas","min","0.5","step","0.5"],["type","number","formControlName","orden","min","1"],["type","submit",1,"btn-primary",3,"disabled"],[1,"dias-section"],[1,"empty-state"],[1,"dia-card"],[1,"dia-header"],[1,"comidas-count"],[1,"comidas-list"],[1,"comida-item"],[1,"comida-info"],[1,"orden"],[1,"comida-details"],[1,"comida-meta"],[1,"badge"],[1,"btn-delete",3,"click"]],template:function(i,r){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"mat-icon"),o(5,"calendar_today"),t(),o(6),t(),n(7,"p",4),o(8,"Asigna comidas a cada d\xEDa del plan nutricional"),t()(),n(9,"button",5),o(10,"\u2190 Volver a planes"),t()(),g(11,X,2,0,"div",6),g(12,ae,40,6,"div",7),t()),i&2&&(d(6),p(" Configurar D\xEDas - ",r.nombrePlan()," "),d(5),f(r.cargando()?11:-1),d(),f(r.cargando()?-1:12))},dependencies:[O,I,B,R,G,U,T,F,$,z,k,L,q,V,j,w,A],styles:[".configurar-dias-container[_ngcontent-%COMP%]{padding:2rem;max-width:1200px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}h1[_ngcontent-%COMP%]{font-size:2rem;color:#2d3748;margin:0}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:#667eea;font-weight:600;cursor:pointer}.add-section[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:12px;margin-bottom:2rem;box-shadow:0 2px 8px #0000001a}.add-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;margin-bottom:1rem}.add-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr) auto;gap:1rem;align-items:end}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;margin-bottom:.25rem;color:#4a5568}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #e2e8f0;border-radius:6px;font-size:.875rem}.form-group[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:.75rem;color:#718096;margin-top:.25rem}.dias-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;margin-bottom:1rem}.dia-card[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1rem;box-shadow:0 2px 8px #0000001a}.dia-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:.75rem;border-bottom:2px solid #e2e8f0}.dia-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.125rem;color:#2d3748;margin:0}.comidas-count[_ngcontent-%COMP%]{background:#edf2f7;padding:.25rem .75rem;border-radius:20px;font-size:.875rem;color:#4a5568}.comidas-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.comida-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#f7fafc;border-radius:8px}.comida-info[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:start;flex:1}.orden[_ngcontent-%COMP%]{font-weight:700;color:#667eea;font-size:1.125rem}.comida-details[_ngcontent-%COMP%]{flex:1}.comida-details[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:#2d3748;margin-bottom:.25rem}.comida-meta[_ngcontent-%COMP%]{display:flex;gap:1rem;font-size:.875rem;color:#718096}.badge[_ngcontent-%COMP%]{background:#e6fffa;color:#234e52;padding:.125rem .5rem;border-radius:12px;font-weight:600;font-size:.75rem}.btn-primary[_ngcontent-%COMP%]{padding:.5rem 1rem;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-size:.875rem}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-delete[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#fc8181;color:#fff;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-size:.875rem}.btn-delete[_ngcontent-%COMP%]:hover{background:#f56565}.loading[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#718096}"]})};export{J as ConfigurarDiasPlanComponent};
