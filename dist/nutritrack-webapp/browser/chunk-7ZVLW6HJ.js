import{a as te}from"./chunk-RAUW4CRJ.js";import{A as z,z as R}from"./chunk-6AXQUQX5.js";import{a as ee}from"./chunk-OBWTC55X.js";import{c as L,e as c,g as G,h as B,k as $,l as J,m as U,n as W,o as Y,s as H,t as K,v as Q,x as X}from"./chunk-M75YHKAC.js";import{a as Z}from"./chunk-F5B3K5RO.js";import"./chunk-6ULEJF3H.js";import{a as T,c as A,d as V}from"./chunk-LBN5CU62.js";import"./chunk-NZVHEJ25.js";import{Bb as O,Db as q,Fb as v,Kc as k,Na as d,Rb as E,Ta as f,Tb as n,Ub as M,Vb as F,_a as N,ca as P,da as S,na as b,nb as s,ob as m,rb as I,sb as w,tb as h,ub as i,vb as t,wb as u}from"./chunk-N5FZ7NRP.js";import{a as D,b as y}from"./chunk-2VMXMS7J.js";var ne=(a,o)=>o.id;function oe(a,o){a&1&&(i(0,"div",6),n(1,"Cargando plan..."),t())}function ae(a,o){a&1&&(i(0,"span",14),n(1,"El nombre es obligatorio"),t())}function re(a,o){a&1&&(i(0,"span",14),n(1,"El nombre debe tener al menos 5 caracteres"),t())}function le(a,o){a&1&&(i(0,"span",14),n(1,"La descripci\xF3n es obligatoria"),t())}function de(a,o){a&1&&(i(0,"span",14),n(1,"La duraci\xF3n es obligatoria"),t())}function ce(a,o){a&1&&(i(0,"span",14),n(1,"La duraci\xF3n m\xEDnima es 1 d\xEDa"),t())}function se(a,o){a&1&&(i(0,"div",32),n(1,"Cargando etiquetas..."),t())}function me(a,o){if(a&1){let e=O();i(0,"label",37)(1,"input",38),q("change",function(){let p=P(e).$implicit,g=v(3);return S(g.toggleEtiqueta(p.id))}),t(),i(2,"span",39)(3,"span",40),n(4),t(),i(5,"span",41),n(6),t()()()}if(a&2){let e=o.$implicit,r=v(3);d(),h("checked",r.etiquetasSeleccionadas().includes(e.id)),d(3),M(e.nombre),d(2),M(r.getTipoLabel(e.tipoEtiqueta))}}function ue(a,o){if(a&1&&(i(0,"div",36),I(1,me,7,3,"label",37,ne),t(),i(3,"small",15),n(4,"Las etiquetas deben existir en el sistema (RN12)"),t()),a&2){let e=v(2);d(),w(e.etiquetasDisponibles())}}function pe(a,o){if(a&1){let e=O();i(0,"form",8),q("ngSubmit",function(){P(e);let p=v();return S(p.guardar())}),i(1,"div",9)(2,"h2"),n(3,"Informaci\xF3n B\xE1sica"),t(),i(4,"div",10)(5,"label",11),n(6,"Nombre del Plan "),i(7,"span",12),n(8,"*"),t()(),u(9,"input",13),s(10,ae,2,0,"span",14),s(11,re,2,0,"span",14),i(12,"small",15),n(13,"El nombre debe ser \xFAnico (RN11)"),t()(),i(14,"div",10)(15,"label",16),n(16,"Descripci\xF3n "),i(17,"span",12),n(18,"*"),t()(),u(19,"textarea",17),s(20,le,2,0,"span",14),t(),i(21,"div",10)(22,"label",18),n(23,"Duraci\xF3n (d\xEDas) "),i(24,"span",12),n(25,"*"),t()(),u(26,"input",19),s(27,de,2,0,"span",14),s(28,ce,2,0,"span",14),t()(),i(29,"div",9)(30,"h2"),n(31,"Objetivos Nutricionales"),t(),i(32,"div",20)(33,"div",10)(34,"label",21),n(35,"Descripci\xF3n del Objetivo"),t(),u(36,"textarea",22),t(),i(37,"div",23)(38,"div",10)(39,"label",24),n(40,"Calor\xEDas Objetivo (kcal) "),i(41,"span",12),n(42,"*"),t()(),u(43,"input",25),t(),i(44,"div",10)(45,"label",26),n(46,"Prote\xEDnas (g) "),i(47,"span",12),n(48,"*"),t()(),u(49,"input",27),t()(),i(50,"div",23)(51,"div",10)(52,"label",28),n(53,"Carbohidratos (g) "),i(54,"span",12),n(55,"*"),t()(),u(56,"input",29),t(),i(57,"div",10)(58,"label",30),n(59,"Grasas (g) "),i(60,"span",12),n(61,"*"),t()(),u(62,"input",31),t()()()(),i(63,"div",9)(64,"h2"),n(65,"Etiquetas"),t(),s(66,se,2,0,"div",32)(67,ue,5,0),t(),i(68,"div",33)(69,"button",34),n(70,"Cancelar"),t(),i(71,"button",35),n(72),t()()()}if(a&2){let e,r,p,g,_,x,C,j,l=v();h("formGroup",l.formulario),d(9),E("error",((e=l.formulario.get("nombre"))==null?null:e.invalid)&&((e=l.formulario.get("nombre"))==null?null:e.touched)),d(),m((r=l.formulario.get("nombre"))!=null&&r.hasError("required")&&((r=l.formulario.get("nombre"))!=null&&r.touched)?10:-1),d(),m((p=l.formulario.get("nombre"))!=null&&p.hasError("minlength")?11:-1),d(8),E("error",((g=l.formulario.get("descripcion"))==null?null:g.invalid)&&((g=l.formulario.get("descripcion"))==null?null:g.touched)),d(),m((_=l.formulario.get("descripcion"))!=null&&_.hasError("required")&&((_=l.formulario.get("descripcion"))!=null&&_.touched)?20:-1),d(6),E("error",((x=l.formulario.get("duracionDias"))==null?null:x.invalid)&&((x=l.formulario.get("duracionDias"))==null?null:x.touched)),d(),m((C=l.formulario.get("duracionDias"))!=null&&C.hasError("required")&&((C=l.formulario.get("duracionDias"))!=null&&C.touched)?27:-1),d(),m((j=l.formulario.get("duracionDias"))!=null&&j.hasError("min")?28:-1),d(38),m(l.cargandoEtiquetas()?66:67),d(5),h("disabled",l.formulario.invalid||l.guardando()),d(),F(" ",l.guardando()?"Guardando...":"Guardar Cambios"," ")}}var ie=class a{constructor(o,e,r,p,g,_){this.fb=o;this.route=e;this.router=r;this.planService=p;this.etiquetaService=g;this.notificationService=_}formulario;cargando=b(!0);guardando=b(!1);cargandoEtiquetas=b(!0);planId;etiquetasDisponibles=b([]);etiquetasSeleccionadas=b([]);ngOnInit(){this.planId=Number(this.route.snapshot.paramMap.get("id")),this.inicializarFormulario(),this.cargarEtiquetas(),this.cargarPlan()}inicializarFormulario(){this.formulario=this.fb.group({nombre:["",[c.required,c.minLength(5)]],descripcion:["",c.required],duracionDias:[7,[c.required,c.min(1),c.max(365)]],objetivo:this.fb.group({caloriasObjetivo:[2e3,[c.required,c.min(1e3),c.max(5e3)]],proteinasObjetivo:[100,[c.required,c.min(0)]],carbohidratosObjetivo:[200,[c.required,c.min(0)]],grasasObjetivo:[60,[c.required,c.min(0)]],descripcion:[""]})})}cargarEtiquetas(){this.etiquetaService.obtenerTodas().subscribe({next:o=>{o.success&&o.data&&this.etiquetasDisponibles.set(o.data),this.cargandoEtiquetas.set(!1)},error:()=>{this.notificationService.showError("Error al cargar etiquetas"),this.cargandoEtiquetas.set(!1)}})}cargarPlan(){this.planService.obtenerPlanPorId(this.planId).subscribe({next:o=>{if(o.success&&o.data){let e=o.data;this.formulario.patchValue({nombre:e.nombre,descripcion:e.descripcion,duracionDias:e.duracionDias}),e.objetivo&&this.formulario.patchValue({objetivo:{caloriasObjetivo:e.objetivo.caloriasObjetivo,proteinasObjetivo:e.objetivo.proteinasObjetivo,carbohidratosObjetivo:e.objetivo.carbohidratosObjetivo,grasasObjetivo:e.objetivo.grasasObjetivo,descripcion:e.objetivo.descripcion||""}}),e.etiquetas&&e.etiquetas.length>0&&this.etiquetasSeleccionadas.set(e.etiquetas.map(r=>r.id)),this.cargando.set(!1)}},error:()=>{this.notificationService.showError("Error al cargar plan"),this.router.navigate(["/admin/planes"])}})}toggleEtiqueta(o){let e=[...this.etiquetasSeleccionadas()],r=e.indexOf(o);r>-1?e.splice(r,1):e.push(o),this.etiquetasSeleccionadas.set(e)}getTipoLabel(o){return{ALERGIA:"Alergia",CONDICION_SALUD:"Condici\xF3n de Salud",PREFERENCIA_ALIMENTARIA:"Preferencia Alimentaria",OBJETIVO_FISICO:"Objetivo F\xEDsico",NIVEL_ACTIVIDAD:"Nivel de Actividad"}[o]||o}guardar(){if(this.formulario.invalid){this.notificationService.showWarning("Por favor completa todos los campos requeridos");return}this.guardando.set(!0);let o=y(D({},this.formulario.value),{etiquetaIds:this.etiquetasSeleccionadas().length>0?this.etiquetasSeleccionadas():void 0});this.planService.actualizarPlan(this.planId,o).subscribe({next:e=>{e.success&&(this.notificationService.showSuccess("Plan actualizado exitosamente"),this.router.navigate(["/admin/planes",this.planId]))},error:e=>{this.guardando.set(!1);let r=e.error?.message||"Error al actualizar el plan";this.notificationService.showError(r)}})}static \u0275fac=function(e){return new(e||a)(f(Q),f(T),f(A),f(te),f(ee),f(Z))};static \u0275cmp=N({type:a,selectors:[["app-editar-plan"]],decls:13,vars:2,consts:[[1,"editar-plan-container"],[1,"page-header"],[1,"header-content"],[1,"page-title"],[1,"page-subtitle"],["routerLink","/admin/planes",1,"btn-link"],[1,"loading"],[1,"plan-form",3,"formGroup"],[1,"plan-form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"form-group"],["for","nombre"],[1,"required"],["id","nombre","type","text","formControlName","nombre","placeholder","Ej: Plan P\xE9rdida de Peso - 7 d\xEDas"],[1,"error-text"],[1,"help-text"],["for","descripcion"],["id","descripcion","formControlName","descripcion","rows","4","placeholder","Describe los beneficios y caracter\xEDsticas del plan..."],["for","duracionDias"],["id","duracionDias","type","number","formControlName","duracionDias","min","1","max","365"],["formGroupName","objetivo"],["for","descripcionObjetivo"],["id","descripcionObjetivo","formControlName","descripcion","rows","2","placeholder","Ej: D\xE9ficit cal\xF3rico moderado con alta prote\xEDna"],[1,"form-row"],["for","calorias"],["id","calorias","type","number","formControlName","caloriasObjetivo","min","1000","max","5000","step","50"],["for","proteinas"],["id","proteinas","type","number","formControlName","proteinasObjetivo","min","0","step","5"],["for","carbohidratos"],["id","carbohidratos","type","number","formControlName","carbohidratosObjetivo","min","0","step","5"],["for","grasas"],["id","grasas","type","number","formControlName","grasasObjetivo","min","0","step","5"],[1,"loading-small"],[1,"form-actions"],["type","button","routerLink","/admin/planes",1,"btn-secondary"],["type","submit",1,"btn-primary",3,"disabled"],[1,"etiquetas-grid"],[1,"etiqueta-checkbox"],["type","checkbox",3,"change","checked"],[1,"etiqueta-info"],[1,"etiqueta-nombre"],[1,"etiqueta-tipo"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"mat-icon"),n(5,"edit"),t(),n(6," Editar Plan Nutricional "),t(),i(7,"p",4),n(8,"Modifica los detalles del plan nutricional"),t()(),i(9,"button",5),n(10,"\u2190 Volver a planes"),t()(),s(11,oe,2,0,"div",6),s(12,pe,73,15,"form",7),t()),e&2&&(d(11),m(r.cargando()?11:-1),d(),m(!r.cargando()&&r.formulario?12:-1))},dependencies:[k,V,X,$,L,J,G,B,K,H,U,Y,W,z,R],styles:[".editar-plan-container[_ngcontent-%COMP%]{padding:2rem;max-width:900px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}h1[_ngcontent-%COMP%]{font-size:2rem;color:#2d3748;margin:0}h2[_ngcontent-%COMP%]{font-size:1.5rem;color:#2d3748;margin:0 0 1.5rem;border-bottom:2px solid #667eea;padding-bottom:.5rem}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:#667eea;font-weight:600;cursor:pointer;font-size:1rem}.btn-link[_ngcontent-%COMP%]:hover{color:#764ba2}.plan-form[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 2px 8px #0000001a}.form-section[_ngcontent-%COMP%]{margin-bottom:2.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}label[_ngcontent-%COMP%]{display:block;font-weight:600;color:#4a5568;margin-bottom:.5rem;font-size:.95rem}.required[_ngcontent-%COMP%]{color:#e53e3e}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #e2e8f0;border-radius:8px;font-size:1rem;transition:border-color .3s}input[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}input.error[_ngcontent-%COMP%], textarea.error[_ngcontent-%COMP%]{border-color:#e53e3e}.error-text[_ngcontent-%COMP%]{color:#e53e3e;font-size:.85rem;display:block;margin-top:.25rem}.help-text[_ngcontent-%COMP%]{color:#718096;font-size:.85rem;display:block;margin-top:.25rem}.etiquetas-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1rem}.etiqueta-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;border:1px solid #e2e8f0;border-radius:8px;cursor:pointer;transition:all .3s}.etiqueta-checkbox[_ngcontent-%COMP%]:hover{border-color:#667eea;background:#f7fafc}.etiqueta-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:20px;height:20px;cursor:pointer}.etiqueta-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.etiqueta-nombre[_ngcontent-%COMP%]{font-weight:600;color:#2d3748}.etiqueta-tipo[_ngcontent-%COMP%]{font-size:.85rem;color:#718096}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:2rem;padding-top:2rem;border-top:1px solid #e2e8f0}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{padding:.75rem 2rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:1rem;transition:all .3s}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background:#edf2f7;color:#4a5568}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e2e8f0}.loading[_ngcontent-%COMP%], .loading-small[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#718096}.loading-small[_ngcontent-%COMP%]{padding:1rem}"]})};export{ie as EditarPlanComponent};
