import{a as Z}from"./chunk-GZZKD4TH.js";import{a as X}from"./chunk-F5B3K5RO.js";import"./chunk-6ULEJF3H.js";import{d as W}from"./chunk-LBN5CU62.js";import"./chunk-NZVHEJ25.js";import{Bb as C,Db as x,Fb as c,Kc as Q,Na as a,Qb as Y,Rb as U,Sb as q,Ta as R,Tb as r,Ub as M,Vb as E,Wb as w,_a as K,ac as y,ca as u,da as g,na as k,nb as m,ob as _,rb as z,sb as N,tb as A,ub as o,vb as i,wb as L}from"./chunk-N5FZ7NRP.js";import{a as I,b as H}from"./chunk-2VMXMS7J.js";var en=()=>["/metas/planes"],tn=()=>["/metas/rutinas"],on=(t,e)=>e.id;function an(t,e){t&1&&(o(0,"div",1)(1,"p"),r(2,"Cargando tus asignaciones..."),i()())}function rn(t,e){t&1&&(o(0,"div",5)(1,"p"),r(2,"No tienes planes activos"),i(),o(3,"button",8),r(4," Explorar planes disponibles "),i()()),t&2&&(a(3),A("routerLink",y(1,en)))}function cn(t,e){t&1&&r(0," \u2705 D\xEDa completado ")}function sn(t,e){if(t&1&&r(0),t&2){let n=c(2).$implicit;w(" \u{1F37D}\uFE0F ",n.comidasCompletadasHoy,"/",n.comidasTotalHoy," comidas hoy ")}}function ln(t,e){if(t&1&&(o(0,"div",17)(1,"span",24),m(2,cn,1,0)(3,sn,1,2),i()()),t&2){let n=c().$implicit;a(),U("completed",n.diaCompletadoHoy),a(),_(n.diaCompletadoHoy?2:3)}}function dn(t,e){if(t&1&&(o(0,"div",19)(1,"span",20),r(2,"Fecha Fin:"),i(),o(3,"span",21),r(4),i()()),t&2){let n=c().$implicit,s=c(3);a(4),M(s.formatearFecha(n.fechaFin))}}function mn(t,e){if(t&1){let n=C();o(0,"div",23)(1,"p",25),r(2,"\u{1F389} \xA1Has completado todos los d\xEDas!"),i(),o(3,"button",26),x("click",function(){u(n);let d=c().$implicit,l=c(3);return g(l.completarPlan(d.id))}),r(4," \u{1F3C6} Finalizar Plan "),i()()}}function _n(t,e){if(t&1){let n=C();o(0,"button",29),x("click",function(){u(n);let d=c(2).$implicit,l=c(3);return g(l.pausarPlan(d.id))}),r(1," Pausar "),i()}}function pn(t,e){if(t&1){let n=C();o(0,"button",29),x("click",function(){u(n);let d=c(2).$implicit,l=c(3);return g(l.reanudarPlan(d.id))}),r(1," Reanudar "),i()}}function un(t,e){if(t&1){let n=C();m(0,_n,2,0,"button",27),m(1,pn,2,0,"button",27),o(2,"button",28),x("click",function(){u(n);let d=c().$implicit,l=c(3);return g(l.cancelarPlan(d.id))}),r(3," Cancelar "),i()}if(t&2){let n=c().$implicit;_(n.estado==="ACTIVO"?0:-1),a(),_(n.estado==="PAUSADO"?1:-1)}}function gn(t,e){if(t&1&&(o(0,"div",9)(1,"div",10)(2,"h3"),r(3),i(),o(4,"span",11),r(5),i()(),o(6,"div",12)(7,"div",13)(8,"span"),r(9),i(),o(10,"span",14),r(11),i()(),o(12,"div",15),L(13,"div",16),i(),m(14,ln,4,3,"div",17),i(),o(15,"div",18)(16,"div",19)(17,"span",20),r(18,"Fecha Inicio:"),i(),o(19,"span",21),r(20),i()(),m(21,dn,5,1,"div",19),i(),o(22,"div",22),m(23,mn,5,0,"div",23)(24,un,4,2),i()()),t&2){let n=e.$implicit,s=c(3);a(3),M(n.planNombre),a(),q("estado-"+n.estado.toLowerCase()),a(),E(" ",s.formatearEstado(n.estado)," "),a(4),w("D\xEDa ",n.diaActual," de ",n.diasTotales),a(2),E("",n.porcentajeCompletado,"%"),a(2),Y("width",n.porcentajeCompletado,"%"),a(),_(n.comidasTotalHoy>0?14:-1),a(6),M(s.formatearFecha(n.fechaInicio)),a(),_(n.fechaFin?21:-1),a(2),_(n.porcentajeCompletado>=100?23:24)}}function Cn(t,e){if(t&1&&(o(0,"div",6),z(1,gn,25,13,"div",9,on),i()),t&2){let n=c(2);a(),N(n.planesActivos())}}function xn(t,e){t&1&&(o(0,"div",5)(1,"p"),r(2,"No tienes rutinas activas"),i(),o(3,"button",8),r(4," Explorar rutinas disponibles "),i()()),t&2&&(a(3),A("routerLink",y(1,tn)))}function fn(t,e){t&1&&r(0," \u2705 D\xEDa completado ")}function vn(t,e){if(t&1&&r(0),t&2){let n=c(2).$implicit;w(" \u{1F4AA} ",n.ejerciciosCompletadosHoy,"/",n.ejerciciosTotalHoy," ejercicios hoy ")}}function bn(t,e){if(t&1&&(o(0,"div",17)(1,"span",24),m(2,fn,1,0)(3,vn,1,2),i()()),t&2){let n=c().$implicit;a(),U("completed",n.diaCompletadoHoy),a(),_(n.diaCompletadoHoy?2:3)}}function hn(t,e){if(t&1&&(o(0,"div",19)(1,"span",20),r(2,"Semana actual:"),i(),o(3,"span",21),r(4),i()()),t&2){let n=c().$implicit;a(4),E("Semana ",n.semanaActual)}}function Mn(t,e){if(t&1){let n=C();o(0,"div",23)(1,"p",25),r(2,"\u{1F389} \xA1Has completado toda la rutina!"),i(),o(3,"button",26),x("click",function(){u(n);let d=c().$implicit,l=c(3);return g(l.completarRutina(d.id))}),r(4," \u{1F3C6} Finalizar Rutina "),i()()}}function En(t,e){if(t&1){let n=C();o(0,"button",29),x("click",function(){u(n);let d=c(2).$implicit,l=c(3);return g(l.pausarRutina(d.id))}),r(1," Pausar "),i()}}function Pn(t,e){if(t&1){let n=C();o(0,"button",29),x("click",function(){u(n);let d=c(2).$implicit,l=c(3);return g(l.reanudarRutina(d.id))}),r(1," Reanudar "),i()}}function Sn(t,e){if(t&1){let n=C();m(0,En,2,0,"button",27),m(1,Pn,2,0,"button",27),o(2,"button",28),x("click",function(){u(n);let d=c().$implicit,l=c(3);return g(l.cancelarRutina(d.id))}),r(3," Cancelar "),i()}if(t&2){let n=c().$implicit;_(n.estado==="ACTIVO"?0:-1),a(),_(n.estado==="PAUSADO"?1:-1)}}function An(t,e){if(t&1&&(o(0,"div",9)(1,"div",10)(2,"h3"),r(3),i(),o(4,"span",11),r(5),i()(),o(6,"div",12)(7,"div",13)(8,"span"),r(9),i(),o(10,"span",14),r(11),i()(),o(12,"div",15),L(13,"div",16),i(),m(14,bn,4,3,"div",17),i(),o(15,"div",18)(16,"div",19)(17,"span",20),r(18,"Fecha Inicio:"),i(),o(19,"span",21),r(20),i()(),m(21,hn,5,1,"div",19),i(),o(22,"div",22),m(23,Mn,5,0,"div",23)(24,Sn,4,2),i()()),t&2){let n=e.$implicit,s=c(3);a(3),M(n.rutinaNombre),a(),q("estado-"+n.estado.toLowerCase()),a(),E(" ",s.formatearEstado(n.estado)," "),a(4),w("D\xEDa ",n.diaActualTotal||n.diaActual," de ",n.diasTotales),a(2),E("",n.porcentajeCompletado,"%"),a(2),Y("width",n.porcentajeCompletado,"%"),a(),_(n.ejerciciosTotalHoy>0?14:-1),a(6),M(s.formatearFecha(n.fechaInicio)),a(),_(n.semanaActual?21:-1),a(2),_(n.porcentajeCompletado>=100?23:24)}}function wn(t,e){if(t&1&&(o(0,"div",6),z(1,An,25,13,"div",9,on),i()),t&2){let n=c(2);a(),N(n.rutinasActivas())}}function yn(t,e){if(t&1&&(o(0,"section",2)(1,"div",3)(2,"h2"),r(3,"Planes Nutricionales Activos"),i(),o(4,"button",4),r(5," Ver todos los planes "),i()(),m(6,rn,5,2,"div",5),m(7,Cn,3,0,"div",6),i(),o(8,"section",7)(9,"div",3)(10,"h2"),r(11,"Rutinas Activas"),i(),o(12,"button",4),r(13," Ver todas las rutinas "),i()(),m(14,xn,5,2,"div",5),m(15,wn,3,0,"div",6),i()),t&2){let n=c();a(4),A("routerLink",y(6,en)),a(2),_(n.planesActivos().length===0?6:-1),a(),_(n.planesActivos().length>0?7:-1),a(5),A("routerLink",y(7,tn)),a(2),_(n.rutinasActivas().length===0?14:-1),a(),_(n.rutinasActivas().length>0?15:-1)}}var nn=class t{constructor(e,n){this.metasService=e;this.notificationService=n}loading=k(!1);planesActivos=k([]);rutinasActivas=k([]);ngOnInit(){this.cargarAsignaciones()}cargarAsignaciones(){this.loading.set(!0),Promise.all([this.metasService.obtenerPlanesActivos().toPromise(),this.metasService.obtenerRutinasActivas().toPromise(),this.metasService.obtenerPlanHoyConEstado().toPromise(),this.metasService.obtenerRutinaHoyConEstado().toPromise()]).then(([e,n,s,d])=>{this.loading.set(!1);let l=s?.data||s||{},P=d?.data||d||{};console.log("\u{1F4CA} Plan Hoy:",l),console.log("\u{1F4CA} Rutina Hoy:",P);let B=l.comidas||[],O=B.filter(f=>f.registrada).length,v=B.length,G=P.ejercicios||[],T=G.filter(f=>f.registrado).length,b=G.length;if(e?.success){let f=e.data||[];console.log("=== PLANES ACTIVOS DEL API ===");let j=f.map(p=>{let D=p.planDuracionDias||this.calcularDiasTotales(p.fechaInicio,p.fechaFin),h=p.diaActual||1,S=h-1,V=v>0?O/v:0,$=(S+V)/D*100,F=Math.min(100,Math.round($));return console.log(`Plan "${p.planNombre}": d\xEDa ${h}/${D}, comidas hoy ${O}/${v}, progreso=${F}%`),H(I({},p),{diasTotales:D,porcentajeCompletado:F,comidasCompletadasHoy:O,comidasTotalHoy:v,diaCompletadoHoy:v>0&&O===v})});this.planesActivos.set(j)}else console.warn("Respuesta de planes no exitosa:",e),this.planesActivos.set([]);if(n?.success){let f=n.data||[];console.log("Rutinas activas del API:",f);let j=f.map(p=>{let h=(p.rutinaDuracionSemanas||4)*7,S=p.semanaActual?(p.semanaActual-1)*7+1:1,V=S-1,$=b>0?T/b:0,F=(V+$)/h*100,J=Math.min(100,Math.round(F));return console.log(`Rutina "${p.rutinaNombre}": d\xEDa ${S}/${h}, ejercicios hoy ${T}/${b}, progreso=${J}%`),H(I({},p),{diasTotales:h,diaActualTotal:S,porcentajeCompletado:J,ejerciciosCompletadosHoy:T,ejerciciosTotalHoy:b,diaCompletadoHoy:b>0&&T===b})});this.rutinasActivas.set(j)}else console.warn("Respuesta de rutinas no exitosa:",n),this.rutinasActivas.set([])}).catch(e=>{this.loading.set(!1),console.error("Error al cargar asignaciones:",e),this.notificationService.showError("Error al cargar tus asignaciones. Verifica tu conexi\xF3n.")})}calcularDiasTotales(e,n){if(!e||!n)return 7;let s=new Date(e),l=new Date(n).getTime()-s.getTime(),P=Math.ceil(l/(1e3*60*60*24))+1;return P>0?P:7}calcularPorcentaje(e,n){return n===0?0:Math.round(e/n*100)}pausarPlan(e){console.log("Pausando plan con ID de asignaci\xF3n:",e),this.metasService.pausarPlan(e).subscribe({next:()=>{this.notificationService.showSuccess("Plan pausado"),this.cargarAsignaciones()},error:n=>{console.error("Error al pausar plan:",n),this.notificationService.showError("Error al pausar plan")}})}reanudarPlan(e){console.log("Reanudando plan con ID de asignaci\xF3n:",e),this.metasService.reanudarPlan(e).subscribe({next:()=>{this.notificationService.showSuccess("Plan reanudado"),this.cargarAsignaciones()},error:n=>{console.error("Error al reanudar plan:",n),this.notificationService.showError("Error al reanudar plan")}})}completarPlan(e){console.log("Completando plan con ID de asignaci\xF3n:",e),this.metasService.completarPlan(e).subscribe({next:()=>{this.mostrarFelicitacion("plan"),this.cargarAsignaciones()},error:n=>{console.error("Error al completar plan:",n),this.notificationService.showError("Error al completar plan")}})}cancelarPlan(e){console.log("Cancelando plan con ID de asignaci\xF3n:",e),this.metasService.cancelarPlan(e).subscribe({next:()=>{this.notificationService.showSuccess("Plan cancelado"),this.cargarAsignaciones()},error:n=>{console.error("Error al cancelar plan:",n),this.notificationService.showError("Error al cancelar plan")}})}pausarRutina(e){console.log("Pausando rutina con ID de asignaci\xF3n:",e),this.metasService.pausarRutina(e).subscribe({next:()=>{this.notificationService.showSuccess("Rutina pausada"),this.cargarAsignaciones()},error:n=>{console.error("Error al pausar rutina:",n),this.notificationService.showError("Error al pausar rutina")}})}reanudarRutina(e){console.log("Reanudando rutina con ID de asignaci\xF3n:",e),this.metasService.reanudarRutina(e).subscribe({next:()=>{this.notificationService.showSuccess("Rutina reanudada"),this.cargarAsignaciones()},error:n=>{console.error("Error al reanudar rutina:",n),this.notificationService.showError("Error al reanudar rutina")}})}completarRutina(e){console.log("Completando rutina con ID de asignaci\xF3n:",e),this.metasService.completarRutina(e).subscribe({next:()=>{this.mostrarFelicitacion("rutina"),this.cargarAsignaciones()},error:n=>{console.error("Error al completar rutina:",n),this.notificationService.showError("Error al completar rutina")}})}cancelarRutina(e){console.log("Cancelando rutina con ID de asignaci\xF3n:",e),this.metasService.cancelarRutina(e).subscribe({next:()=>{this.notificationService.showSuccess("Rutina cancelada"),this.cargarAsignaciones()},error:n=>{console.error("Error al cancelar rutina:",n),this.notificationService.showError("Error al cancelar rutina")}})}mostrarFelicitacion(e){let s={plan:{titulo:"\u{1F3C6} \xA1Felicitaciones!",mensaje:"\xA1Has completado tu plan nutricional con \xE9xito! Tu dedicaci\xF3n y compromiso han dado frutos. \xA1Sigue as\xED!"},rutina:{titulo:"\u{1F4AA} \xA1Excelente trabajo!",mensaje:"\xA1Has completado tu rutina de ejercicios! Tu esfuerzo y constancia te han llevado al \xE9xito. \xA1Eres incre\xEDble!"}}[e];this.notificationService.success(s.titulo,s.mensaje,8e3)}formatearEstado(e){return{ACTIVO:"Activo",PAUSADO:"Pausado",COMPLETADO:"Completado",CANCELADO:"Cancelado"}[e]||e}formatearFecha(e){return new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})}static \u0275fac=function(n){return new(n||t)(R(Z),R(X))};static \u0275cmp=K({type:t,selectors:[["app-mis-asignaciones"]],decls:3,vars:2,consts:[[1,"mis-asignaciones-container"],[1,"loading"],[1,"planes-section"],[1,"section-header"],[1,"btn-view-all",3,"routerLink"],[1,"empty-state"],[1,"asignaciones-grid"],[1,"rutinas-section"],[1,"btn-link",3,"routerLink"],[1,"asignacion-card"],[1,"card-header"],[1,"estado-badge"],[1,"progress-info"],[1,"progress-text"],[1,"percentage"],[1,"progress-bar"],[1,"progress-fill"],[1,"activity-stats"],[1,"card-info"],[1,"info-item"],[1,"label"],[1,"value"],[1,"card-actions"],[1,"ready-to-complete"],[1,"stat-item"],[1,"congrats-text"],[1,"btn-complete-final",3,"click"],[1,"btn-secondary"],[1,"btn-danger",3,"click"],[1,"btn-secondary",3,"click"]],template:function(n,s){n&1&&(o(0,"div",0),m(1,an,3,0,"div",1),m(2,yn,16,8),i()),n&2&&(a(),_(s.loading()?1:-1),a(),_(s.loading()?-1:2))},dependencies:[Q,W],styles:[".mis-asignaciones-container[_ngcontent-%COMP%]{padding:2rem;max-width:1400px;margin:0 auto}.header[_ngcontent-%COMP%]{margin-bottom:3rem;text-align:center}h1[_ngcontent-%COMP%]{font-size:2.5rem;color:#2d3748;margin:0 0 .5rem}.subtitle[_ngcontent-%COMP%]{color:#718096;font-size:1.125rem;margin:0}section[_ngcontent-%COMP%]{margin-bottom:3rem}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;flex-wrap:wrap;gap:1rem}section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#2d3748;margin:0;font-size:1.5rem}.btn-view-all[_ngcontent-%COMP%]{padding:.625rem 1.25rem;background:#667eea;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:.875rem;transition:all .2s;white-space:nowrap}.btn-view-all[_ngcontent-%COMP%]:hover{background:#764ba2;transform:translateY(-1px);box-shadow:0 2px 8px #667eea4d}.asignaciones-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:1.5rem}.asignacion-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 2px 8px #0000001a;display:flex;flex-direction:column;transition:transform .2s,box-shadow .2s}.asignacion-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 4px 16px #00000026}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:start;margin-bottom:1rem;gap:1rem}.card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#2d3748;font-size:1.25rem;flex:1}.estado-badge[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:20px;font-size:.75rem;font-weight:600;white-space:nowrap}.estado-badge.estado-activo[_ngcontent-%COMP%]{background:#c6f6d5;color:#22543d}.estado-badge.estado-pausado[_ngcontent-%COMP%]{background:#bee3f8;color:#2c5282}.estado-badge.estado-completado[_ngcontent-%COMP%]{background:#c6f6d5;color:#22543d}.estado-badge.estado-cancelado[_ngcontent-%COMP%]{background:#fed7d7;color:#742a2a}.progress-info[_ngcontent-%COMP%]{margin-bottom:1rem}.progress-text[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;font-size:.875rem;color:#718096}.percentage[_ngcontent-%COMP%]{font-weight:600;color:#2d3748}.progress-bar[_ngcontent-%COMP%]{width:100%;height:8px;background:#e2e8f0;border-radius:10px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#48bb78,#38a169);transition:width .3s ease}.activity-stats[_ngcontent-%COMP%]{margin-top:.5rem;display:flex;justify-content:center}.stat-item[_ngcontent-%COMP%]{font-size:.75rem;color:#718096;background:#f0fff4;padding:.25rem .75rem;border-radius:12px;border:1px solid #c6f6d5}.stat-item.completed[_ngcontent-%COMP%]{background:#48bb78;color:#fff;border-color:#38a169;font-weight:600}.card-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;margin-bottom:1rem;padding:1rem;background:#f7fafc;border-radius:8px}.info-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:.875rem}.info-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#718096}.info-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#2d3748;font-weight:600}.card-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:auto}.btn-secondary[_ngcontent-%COMP%], .btn-danger[_ngcontent-%COMP%], .btn-success[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:.75rem;transition:all .2s;flex:1;min-width:80px}.btn-secondary[_ngcontent-%COMP%]{background:#edf2f7;color:#4a5568}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e2e8f0}.btn-danger[_ngcontent-%COMP%]{background:#fed7d7;color:#742a2a}.btn-danger[_ngcontent-%COMP%]:hover{background:#fc8181}.btn-success[_ngcontent-%COMP%]{background:#c6f6d5;color:#22543d}.btn-success[_ngcontent-%COMP%]:hover{background:#9ae6b4}.ready-to-complete[_ngcontent-%COMP%]{width:100%;text-align:center;padding:1rem;background:linear-gradient(135deg,#f6e05e,#ecc94b);border-radius:12px;animation:_ngcontent-%COMP%_pulse-glow 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse-glow{0%,to{box-shadow:0 0 5px #ecc94b80}50%{box-shadow:0 0 20px #ecc94bcc}}.congrats-text[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:1rem;font-weight:600;color:#744210}.btn-complete-final[_ngcontent-%COMP%]{width:100%;padding:.875rem 1.5rem;background:linear-gradient(135deg,#48bb78,#38a169);color:#fff;border:none;border-radius:8px;font-size:1.125rem;font-weight:700;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 15px #48bb7866}.btn-complete-final[_ngcontent-%COMP%]:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 6px 20px #48bb7899}.btn-complete-final[_ngcontent-%COMP%]:active{transform:translateY(0)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem;background:#f7fafc;border-radius:12px;color:#718096}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.125rem}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:#667eea;font-weight:600;cursor:pointer;text-decoration:underline;font-size:1rem}.btn-link[_ngcontent-%COMP%]:hover{color:#764ba2}.loading[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#718096}"]})};export{nn as MisAsignacionesComponent};
