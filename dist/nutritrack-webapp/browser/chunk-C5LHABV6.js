import{a as U}from"./chunk-65QLZD5N.js";import{a as V}from"./chunk-SLRXGNQN.js";import{b as D,c as j,g as A,j as T,p as F,q as z,r as W,w as q}from"./chunk-M75YHKAC.js";import{a as R}from"./chunk-GZZKD4TH.js";import{a as G}from"./chunk-F5B3K5RO.js";import"./chunk-6ULEJF3H.js";import{d as L}from"./chunk-LBN5CU62.js";import"./chunk-NZVHEJ25.js";import{Bb as y,Db as u,Fb as m,Kc as I,Na as l,Rb as w,Ta as f,Tb as r,Ub as _,Vb as b,Xb as C,Yb as x,Zb as M,_a as E,ac as N,bc as k,ca as S,da as O,na as g,nb as c,ob as p,rb as h,sb as P,tb as v,ub as a,vb as n}from"./chunk-N5FZ7NRP.js";import"./chunk-2VMXMS7J.js";var $=()=>["/metas/mis-asignaciones"],H=o=>["/metas/planes",o],Y=(o,e)=>e.id;function J(o,e){o&1&&(a(0,"div",18)(1,"p"),r(2,"Cargando planes..."),n()())}function K(o,e){o&1&&(a(0,"p",21),r(1,"Intenta desactivar el filtro de planes sugeridos"),n())}function Q(o,e){if(o&1&&(a(0,"div",19)(1,"p"),r(2,"No se encontraron planes disponibles con los filtros seleccionados"),n(),c(3,K,2,0,"p",21),n()),o&2){let t=m();l(3),p(t.soloSugeridos?3:-1)}}function X(o,e){o&1&&(a(0,"span",25),r(1,"\u2728 Sugerido"),n())}function Z(o,e){if(o&1&&(a(0,"div",28)(1,"span",29),r(2,"Objetivo:"),n(),a(3,"span",30),r(4),n()(),a(5,"div",28)(6,"span",29),r(7,"Calor\xEDas:"),n(),a(8,"span",30),r(9),n()()),o&2){let t=m().$implicit,i=m(2);l(4),_(i.formatearObjetivo(t.objetivo.tipoObjetivo)),l(5),b("",t.objetivo.caloriasObjetivo," kcal")}}function ee(o,e){o&1&&(a(0,"div",28)(1,"span",29),r(2,"Objetivo:"),n(),a(3,"span",35),r(4,"No especificado"),n()())}function te(o,e){if(o&1&&(a(0,"span",36),r(1),n()),o&2){let t=e.$implicit;l(),_(t.nombre)}}function ne(o,e){if(o&1&&(a(0,"div",31),h(1,te,2,1,"span",36,Y),n()),o&2){let t=m().$implicit;l(),P(t.etiquetas)}}function ie(o,e){if(o&1){let t=y();a(0,"div",23)(1,"div",24)(2,"h3"),r(3),n(),c(4,X,2,0,"span",25),n(),a(5,"p",26),r(6),n(),a(7,"div",27)(8,"div",28)(9,"span",29),r(10,"Duraci\xF3n:"),n(),a(11,"span",30),r(12),n()(),c(13,Z,10,2)(14,ee,5,0,"div",28),n(),c(15,ne,3,0,"div",31),a(16,"div",32)(17,"button",33),r(18," Ver Detalles "),n(),a(19,"button",34),u("click",function(){let d=S(t).$implicit,s=m(2);return O(s.activarPlan(d))}),r(20),n()()()}if(o&2){let t=e.$implicit,i=m(2);w("plan-sugerido",t.sugerido),l(3),_(t.nombre),l(),p(t.sugerido?4:-1),l(2),_(t.descripcion),l(6),b("",t.duracionDias," d\xEDas"),l(),p(t.objetivo?13:14),l(2),p(t.etiquetas&&t.etiquetas.length>0?15:-1),l(2),v("routerLink",k(11,H,t.id)),l(2),v("disabled",i.activandoPlan()===t.id),l(),b(" ",i.activandoPlan()===t.id?"Activando...":"Activar Plan"," ")}}function ae(o,e){if(o&1&&(a(0,"div",20),h(1,ie,21,13,"div",22,Y),n()),o&2){let t=m();l(),P(t.planesFiltrados())}}var B=class o{constructor(e,t,i,d){this.catalogoService=e;this.metasService=t;this.notificationService=i;this.mockData=d}loading=g(!1);activandoPlan=g(null);filtroNombre="";filtroObjetivo="";soloSugeridos=!1;planes=g([]);planesFiltrados=g([]);planesActivosIds=g(new Set);ngOnInit(){this.cargarPlanesActivos(),this.cargarPlanes()}cargarPlanesActivos(){this.metasService.obtenerPlanesActivos().subscribe({next:e=>{if(e.success&&e.data){let t=new Set(e.data.map(i=>i.planId));this.planesActivosIds.set(t),this.filtrarPlanes()}},error:e=>{console.warn("No se pudieron cargar planes activos:",e)}})}cargarPlanes(){this.loading.set(!0),this.catalogoService.verCatalogo(this.soloSugeridos).subscribe({next:e=>{if(this.loading.set(!1),e.success){let t=e.data?.content||e.data||[];t.length>0?(this.planes.set(t),this.filtrarPlanes()):(this.planes.set(this.mockData.planesDisponibles()),this.filtrarPlanes(),this.notificationService.showInfo("No hay planes en el cat\xE1logo. Mostrando ejemplos."))}else this.planes.set(this.mockData.planesDisponibles()),this.filtrarPlanes()},error:e=>{this.loading.set(!1),console.error("Error cargando cat\xE1logo de planes:",e),this.planes.set(this.mockData.planesDisponibles()),this.filtrarPlanes(),this.notificationService.showWarning("Sin conexi\xF3n al servidor. Mostrando datos de ejemplo.")}})}filtrarPlanes(){let e=this.planes(),t=this.planesActivosIds();if(e=e.filter(i=>!t.has(i.id)),this.filtroNombre){let i=this.filtroNombre.toLowerCase();e=e.filter(d=>d.nombre.toLowerCase().includes(i)||d.descripcion.toLowerCase().includes(i))}this.filtroObjetivo&&(e=e.filter(i=>i.objetivo?.tipoObjetivo===this.filtroObjetivo)),this.planesFiltrados.set(e)}activarPlan(e){this.activandoPlan.set(e.id),this.metasService.activarPlan({planId:e.id}).subscribe({next:t=>{this.activandoPlan.set(null),t.success?(this.notificationService.showSuccess(`Plan "${e.nombre}" activado exitosamente`),this.cargarPlanesActivos()):this.notificationService.showError(t.message||"Error al activar el plan")},error:t=>{this.activandoPlan.set(null);let i=t?.message||"Error al activar el plan";this.notificationService.showError(i)}})}formatearObjetivo(e){return{PERDIDA_PESO:"P\xE9rdida de Peso",GANANCIA_MUSCULAR:"Ganancia Muscular",MANTENIMIENTO:"Mantenimiento",DEFINICION:"Definici\xF3n",SALUD_GENERAL:"Salud General"}[e]||e}static \u0275fac=function(t){return new(t||o)(f(U),f(R),f(G),f(V))};static \u0275cmp=E({type:o,selectors:[["app-catalogo-lista-planes"]],decls:33,vars:8,consts:[[1,"catalogo-planes-container"],[1,"header"],[1,"btn-back",3,"routerLink"],[1,"subtitle"],[1,"filters"],[1,"search-box"],["type","text","placeholder","Buscar por nombre...",3,"ngModelChange","ngModel"],[1,"filter-objetivo"],[3,"ngModelChange","ngModel"],["value",""],["value","PERDIDA_PESO"],["value","GANANCIA_MUSCULAR"],["value","MANTENIMIENTO"],["value","DEFINICION"],["value","SALUD_GENERAL"],[1,"filter-sugeridos"],[1,"checkbox-label"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"loading"],[1,"empty-state"],[1,"planes-grid"],[1,"hint"],[1,"plan-card",3,"plan-sugerido"],[1,"plan-card"],[1,"plan-header"],[1,"badge-sugerido"],[1,"plan-description"],[1,"plan-stats"],[1,"stat"],[1,"stat-label"],[1,"stat-value"],[1,"plan-etiquetas"],[1,"plan-actions"],[1,"btn-primary",3,"routerLink"],[1,"btn-activate",3,"click","disabled"],[1,"stat-value","text-muted"],[1,"etiqueta"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),r(3," \u2190 Volver a Mis Asignaciones "),n(),a(4,"h1"),r(5,"Cat\xE1logo de Planes Nutricionales"),n(),a(6,"p",3),r(7,"Explora planes disponibles seg\xFAn tu perfil y objetivos"),n()(),a(8,"div",4)(9,"div",5)(10,"input",6),M("ngModelChange",function(s){return x(i.filtroNombre,s)||(i.filtroNombre=s),s}),u("ngModelChange",function(){return i.filtrarPlanes()}),n()(),a(11,"div",7)(12,"select",8),M("ngModelChange",function(s){return x(i.filtroObjetivo,s)||(i.filtroObjetivo=s),s}),u("ngModelChange",function(){return i.filtrarPlanes()}),a(13,"option",9),r(14,"Todos los objetivos"),n(),a(15,"option",10),r(16,"P\xE9rdida de Peso"),n(),a(17,"option",11),r(18,"Ganancia Muscular"),n(),a(19,"option",12),r(20,"Mantenimiento"),n(),a(21,"option",13),r(22,"Definici\xF3n"),n(),a(23,"option",14),r(24,"Salud General"),n()()(),a(25,"div",15)(26,"label",16)(27,"input",17),M("ngModelChange",function(s){return x(i.soloSugeridos,s)||(i.soloSugeridos=s),s}),u("ngModelChange",function(){return i.cargarPlanes()}),n(),a(28,"span"),r(29,"Solo planes sugeridos para mi objetivo"),n()()()(),c(30,J,3,0,"div",18),c(31,Q,4,1,"div",19),c(32,ae,3,0,"div",20),n()),t&2&&(l(2),v("routerLink",N(7,$)),l(8),C("ngModel",i.filtroNombre),l(2),C("ngModel",i.filtroObjetivo),l(15),C("ngModel",i.soloSugeridos),l(3),p(i.loading()?30:-1),l(),p(!i.loading()&&i.planesFiltrados().length===0?31:-1),l(),p(!i.loading()&&i.planesFiltrados().length>0?32:-1))},dependencies:[I,L,q,z,W,j,D,F,A,T],styles:[".catalogo-planes-container[_ngcontent-%COMP%]{padding:2rem;max-width:1400px;margin:0 auto}.header[_ngcontent-%COMP%]{margin-bottom:2rem;text-align:center;position:relative}.btn-back[_ngcontent-%COMP%]{position:absolute;left:0;top:0;padding:.625rem 1.25rem;background:#edf2f7;color:#4a5568;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:.875rem;transition:all .2s}.btn-back[_ngcontent-%COMP%]:hover{background:#e2e8f0;transform:translate(-2px)}h1[_ngcontent-%COMP%]{font-size:2.5rem;color:#2d3748;margin:0 0 .5rem}.subtitle[_ngcontent-%COMP%]{color:#718096;font-size:1.125rem;margin:0}.filters[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:2rem;align-items:center;flex-wrap:wrap}.search-box[_ngcontent-%COMP%]{flex:1;min-width:250px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #e2e8f0;border-radius:8px;font-size:1rem}.filter-objetivo[_ngcontent-%COMP%]{min-width:200px}.filter-objetivo[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #e2e8f0;border-radius:8px;font-size:1rem;background-color:#fff}.filter-sugeridos[_ngcontent-%COMP%]{display:flex;align-items:center}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer;font-size:.95rem;color:#4a5568}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer}.planes-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:1.5rem}.plan-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 2px 8px #0000001a;transition:transform .2s,box-shadow .2s;display:flex;flex-direction:column;border:2px solid transparent}.plan-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 4px 16px #00000026}.plan-card.plan-sugerido[_ngcontent-%COMP%]{border-color:#f6ad55;background:linear-gradient(to bottom,#fffaf0,#fff)}.plan-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:start;margin-bottom:1rem;gap:1rem}.plan-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;color:#2d3748;flex:1}.badge-sugerido[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:20px;font-size:.75rem;font-weight:600;background:linear-gradient(135deg,#f6ad55,#ed8936);color:#fff;white-space:nowrap}.plan-description[_ngcontent-%COMP%]{color:#718096;margin-bottom:1rem;line-height:1.5}.plan-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;margin-bottom:1rem;padding:1rem;background:#f7fafc;border-radius:8px}.stat[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-label[_ngcontent-%COMP%]{font-size:.875rem;color:#718096;margin-bottom:.25rem}.stat-value[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#2d3748}.stat-value.text-muted[_ngcontent-%COMP%]{color:#a0aec0;font-style:italic}.plan-etiquetas[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem}.etiqueta[_ngcontent-%COMP%]{padding:.25rem .75rem;background:#edf2f7;color:#4a5568;border-radius:20px;font-size:.875rem}.plan-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:auto}.btn-primary[_ngcontent-%COMP%], .btn-activate[_ngcontent-%COMP%]{padding:.625rem 1rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all .2s;font-size:.875rem;flex:1;min-width:120px}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.btn-activate[_ngcontent-%COMP%]{background:#48bb78;color:#fff}.btn-activate[_ngcontent-%COMP%]:hover:not(:disabled){background:#38a169;transform:translateY(-2px);box-shadow:0 4px 12px #48bb7866}.btn-activate[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.loading[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#718096}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.125rem}.empty-state[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:.95rem;color:#a0aec0;margin-top:.5rem}"]})};export{B as MetasListaPlanesComponent};
