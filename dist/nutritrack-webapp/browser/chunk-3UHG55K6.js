import{a as B}from"./chunk-Y4ECP4HO.js";import{a as Y}from"./chunk-SMVVNKRT.js";import{c as I,e as l,g as w,h as k,k as F,l as R,m as z,o as T,p as V,q as j,r as $,s as G,t as U,u as q,w as L}from"./chunk-2VZLF2MU.js";import"./chunk-6LZ2YNEV.js";import{d as N,f as y,g as A}from"./chunk-7Q5XKRGT.js";import{$ as v,Ka as r,Mb as a,Nb as M,Ob as c,Pa as u,Va as E,aa as b,ib as g,jb as f,ka as s,lb as x,mb as P,nb as _,ob as n,pb as t,qb as C,ub as h,wb as D,xc as O,yb as p}from"./chunk-FVUT7SF7.js";import"./chunk-2VMXMS7J.js";var Z=(o,e)=>e.dia,H=(o,e)=>e.id;function J(o,e){o&1&&(n(0,"div",3),a(1,"Cargando configuraci\xF3n..."),t())}function Q(o,e){o&1&&(n(0,"div",21)(1,"p"),a(2,"No hay comidas asignadas a\xFAn. Comienza agregando comidas para cada d\xEDa."),t()())}function W(o,e){if(o&1&&(n(0,"span"),a(1),t()),o&2){let i=p().$implicit;r(),c("",i.comida.calorias," kcal")}}function X(o,e){if(o&1){let i=h();n(0,"div",26)(1,"div",27)(2,"span",28),a(3),t(),n(4,"div",29)(5,"strong"),a(6),t(),n(7,"div",30)(8,"span",31),a(9),t(),g(10,W,2,1,"span"),t()()(),n(11,"button",32),D("click",function(){let m=v(i).$implicit,S=p(3);return b(S.eliminarDia(m.id))}),a(12," Eliminar "),t()()}if(o&2){let i=e.$implicit,d=p().$implicit,m=p(2);r(3),c("",d.comidas.indexOf(i)+1,"."),r(3),M(i.comida.nombre),r(3),M(m.formatearTipoComida(i.tipoComida)),r(),f(i.comida.calorias?10:-1)}}function ee(o,e){if(o&1&&(n(0,"div",22)(1,"div",23)(2,"h3"),a(3),t(),n(4,"span",24),a(5),t()(),n(6,"div",25),x(7,X,13,4,"div",26,H),t()()),o&2){let i=e.$implicit;r(3),c("D\xEDa ",i.dia),r(2),c("",i.comidas.length," comida(s)"),r(2),P(i.comidas)}}function ie(o,e){if(o&1){let i=h();n(0,"div",4)(1,"div",5)(2,"h2"),a(3,"Agregar Comida al Plan"),t(),n(4,"form",6),D("ngSubmit",function(){v(i);let m=p();return b(m.agregarDia())}),n(5,"div",7)(6,"div",8)(7,"label"),a(8,"D\xEDa"),t(),C(9,"input",9),n(10,"small"),a(11),t()(),n(12,"div",8)(13,"label"),a(14,"ID Comida"),t(),C(15,"input",10),n(16,"small"),a(17,"ID de comida existente"),t()(),n(18,"div",8)(19,"label"),a(20,"Tipo"),t(),n(21,"select",11)(22,"option",12),a(23,"Desayuno"),t(),n(24,"option",13),a(25,"Almuerzo"),t(),n(26,"option",14),a(27,"Cena"),t(),n(28,"option",15),a(29,"Snack"),t(),n(30,"option",16),a(31,"Merienda"),t()()(),n(32,"div",8)(33,"label"),a(34,"Porciones"),t(),C(35,"input",17),t(),n(36,"div",8)(37,"label"),a(38,"Orden"),t(),C(39,"input",18),t(),n(40,"button",19),a(41),t()()()(),n(42,"div",20)(43,"h2"),a(44,"D\xEDas Configurados"),t(),g(45,Q,3,0,"div",21),x(46,ee,9,2,"div",22,Z),t()()}if(o&2){let i=p();r(4),_("formGroup",i.formulario),r(5),_("max",i.duracionDias()),r(2),c("De 1 a ",i.duracionDias()),r(29),_("disabled",i.formulario.invalid||i.guardando()),r(),c(" ",i.guardando()?"Agregando...":"+ Agregar"," "),r(4),f(i.diasAgrupados().length===0?45:-1),r(),P(i.diasAgrupados())}}var K=class o{constructor(e,i,d,m,S){this.fb=e;this.route=i;this.router=d;this.planService=m;this.notificationService=S;this.inicializarFormulario()}formulario;planId;nombrePlan=s("");duracionDias=s(7);cargando=s(!0);guardando=s(!1);dias=s([]);diasAgrupados=s([]);ngOnInit(){this.planId=Number(this.route.snapshot.paramMap.get("id")),this.cargarPlan()}inicializarFormulario(){this.formulario=this.fb.group({numeroDia:[1,[l.required,l.min(1)]],comidaId:["",[l.required,l.min(1)]],tipoComida:["DESAYUNO",l.required],porcionesRecomendadas:[1,[l.required,l.min(.5)]],orden:[1,[l.required,l.min(1)]]})}cargarPlan(){this.planService.obtenerPlanPorId(this.planId).subscribe({next:e=>{e.success&&e.data&&(this.nombrePlan.set(e.data.nombre),this.duracionDias.set(e.data.duracionDias),this.dias.set(e.data.dias||[]),this.agruparDias(),this.cargando.set(!1))},error:()=>{this.notificationService.showError("Error al cargar plan"),this.router.navigate(["/admin/planes"])}})}agruparDias(){let e=new Map;this.dias().forEach(d=>{e.has(d.numeroDia)||e.set(d.numeroDia,[]),e.get(d.numeroDia).push(d)});let i=Array.from(e.entries()).map(([d,m])=>({dia:d,comidas:m})).sort((d,m)=>d.dia-m.dia);this.diasAgrupados.set(i)}agregarDia(){if(this.formulario.invalid){this.formulario.markAllAsTouched();return}this.guardando.set(!0),this.planService.agregarDiaAlPlan(this.planId,this.formulario.value).subscribe({next:e=>{this.guardando.set(!1),e.success&&(this.notificationService.showSuccess("Comida agregada al d\xEDa"),this.formulario.reset({numeroDia:1,tipoComida:"DESAYUNO",porcionesRecomendadas:1,orden:1}),this.cargarPlan())},error:e=>{this.guardando.set(!1),this.notificationService.showError(e.error?.message||"Error al agregar comida")}})}eliminarDia(e){confirm("\xBFEliminar esta comida del plan?")&&this.planService.eliminarDiaDelPlan(this.planId,e).subscribe({next:i=>{i.success&&(this.notificationService.showSuccess("Comida eliminada"),this.cargarPlan())},error:()=>{this.notificationService.showError("Error al eliminar")}})}formatearTipoComida(e){return{DESAYUNO:"Desayuno",ALMUERZO:"Almuerzo",CENA:"Cena",SNACK:"Snack",MERIENDA:"Merienda"}[e]||e}static \u0275fac=function(i){return new(i||o)(u(q),u(N),u(y),u(B),u(Y))};static \u0275cmp=E({type:o,selectors:[["app-configurar-dias-plan"]],decls:8,vars:3,consts:[[1,"configurar-dias-container"],[1,"header"],["routerLink","/admin/planes",1,"btn-link"],[1,"loading"],[1,"content"],[1,"add-section"],[1,"add-form",3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group"],["type","number","formControlName","numeroDia","min","1",3,"max"],["type","number","formControlName","comidaId","min","1"],["formControlName","tipoComida"],["value","DESAYUNO"],["value","ALMUERZO"],["value","CENA"],["value","SNACK"],["value","MERIENDA"],["type","number","formControlName","porcionesRecomendadas","min","0.5","step","0.5"],["type","number","formControlName","orden","min","1"],["type","submit",1,"btn-primary",3,"disabled"],[1,"dias-section"],[1,"empty-state"],[1,"dia-card"],[1,"dia-header"],[1,"comidas-count"],[1,"comidas-list"],[1,"comida-item"],[1,"comida-info"],[1,"orden"],[1,"comida-details"],[1,"comida-meta"],[1,"badge"],[1,"btn-delete",3,"click"]],template:function(i,d){i&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),a(3),t(),n(4,"button",2),a(5,"\u2190 Volver a planes"),t()(),g(6,J,2,0,"div",3),g(7,ie,48,6,"div",4),t()),i&2&&(r(3),c("Configurar D\xEDas - ",d.nombrePlan()),r(3),f(d.cargando()?6:-1),r(),f(d.cargando()?-1:7))},dependencies:[O,A,L,F,j,$,I,R,V,w,k,U,G,z,T],styles:[".configurar-dias-container[_ngcontent-%COMP%]{padding:2rem;max-width:1200px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}h1[_ngcontent-%COMP%]{font-size:2rem;color:#2d3748;margin:0}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:#667eea;font-weight:600;cursor:pointer}.add-section[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:12px;margin-bottom:2rem;box-shadow:0 2px 8px #0000001a}.add-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;margin-bottom:1rem}.add-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr) auto;gap:1rem;align-items:end}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;margin-bottom:.25rem;color:#4a5568}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #e2e8f0;border-radius:6px;font-size:.875rem}.form-group[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:.75rem;color:#718096;margin-top:.25rem}.dias-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;margin-bottom:1rem}.dia-card[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1rem;box-shadow:0 2px 8px #0000001a}.dia-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:.75rem;border-bottom:2px solid #e2e8f0}.dia-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.125rem;color:#2d3748;margin:0}.comidas-count[_ngcontent-%COMP%]{background:#edf2f7;padding:.25rem .75rem;border-radius:20px;font-size:.875rem;color:#4a5568}.comidas-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.comida-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#f7fafc;border-radius:8px}.comida-info[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:start;flex:1}.orden[_ngcontent-%COMP%]{font-weight:700;color:#667eea;font-size:1.125rem}.comida-details[_ngcontent-%COMP%]{flex:1}.comida-details[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:#2d3748;margin-bottom:.25rem}.comida-meta[_ngcontent-%COMP%]{display:flex;gap:1rem;font-size:.875rem;color:#718096}.badge[_ngcontent-%COMP%]{background:#e6fffa;color:#234e52;padding:.125rem .5rem;border-radius:12px;font-weight:600;font-size:.75rem}.btn-primary[_ngcontent-%COMP%]{padding:.5rem 1rem;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-size:.875rem}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-delete[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#fc8181;color:#fff;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-size:.875rem}.btn-delete[_ngcontent-%COMP%]:hover{background:#f56565}.loading[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#718096}"]})};export{K as ConfigurarDiasPlanComponent};
