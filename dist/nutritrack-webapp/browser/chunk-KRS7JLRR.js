import{a as et,b as nt,c as it}from"./chunk-R7JGX3WZ.js";import{a as tt}from"./chunk-5EP6LFYW.js";import{c as Z}from"./chunk-6H7SMGZH.js";import{a as H,c as J,e as K,f as Q,g as X,j as Y}from"./chunk-M6FO7V5J.js";import{a as G,b as W}from"./chunk-AERAWHYX.js";import{a as q}from"./chunk-FAQLDPXB.js";import"./chunk-3ERIXVYS.js";import"./chunk-VRXVPH7L.js";import{n as T,o as R}from"./chunk-IEOKP2HD.js";import{A as D,z as j}from"./chunk-7NAIVTKU.js";import{a as U}from"./chunk-AVXLCIQN.js";import{c as V,g as z,j as B,w as $}from"./chunk-GRSFFSFU.js";import"./chunk-Q53AFBXZ.js";import{d as I,e as N}from"./chunk-ONQJZTIX.js";import"./chunk-N5IZLMDI.js";import{$b as M,Bb as u,Db as c,Ec as F,Ma as s,Pb as P,Rb as r,Sa as v,Sb as x,Tb as C,Vb as E,Wb as y,Xb as k,Za as w,ba as f,ca as b,ma as m,mb as p,nb as g,ob as A,pb as S,qb as O,rb as _,sb as a,tb as i,ub as L,zb as h}from"./chunk-D6HZ3QFW.js";import"./chunk-2VMXMS7J.js";var ot=o=>["/admin/planes",o],rt=o=>["/admin/planes",o,"comidas"],lt=o=>["/admin/planes",o,"editar"],st=(o,e)=>e.id;function ct(o,e){o&1&&(a(0,"div",12)(1,"mat-icon"),r(2,"hourglass_empty"),i(),a(3,"p"),r(4,"Cargando planes..."),i()())}function dt(o,e){o&1&&(a(0,"mat-card")(1,"mat-card-content")(2,"div",13)(3,"mat-icon",14),r(4,"restaurant_menu"),i(),a(5,"h3"),r(6,"No hay planes registrados"),i(),a(7,"p"),r(8,"Comienza creando tu primer plan nutricional para el sistema"),i(),a(9,"button",5)(10,"mat-icon"),r(11,"add"),i(),r(12," Crear Primer Plan "),i()()()())}function mt(o,e){if(o&1&&(a(0,"span",37),r(1),i()),o&2){let t=c(2).$implicit;s(),x(t.objetivo.descripcion)}}function pt(o,e){if(o&1&&(a(0,"div",26)(1,"span",36),r(2),i(),p(3,mt,2,1,"span",37),i()),o&2){let t=c().$implicit;s(2),C("",t.objetivo.caloriasObjetivo," kcal"),s(),g(t.objetivo.descripcion?3:-1)}}function gt(o,e){o&1&&(a(0,"span",27),r(1,"Sin objetivo"),i())}function ut(o,e){if(o&1){let t=h();a(0,"button",38),u("click",function(){f(t);let l=c().$implicit,d=c(2);return b(d.confirmarDesactivar(l))}),a(1,"mat-icon"),r(2,"toggle_off"),i()()}if(o&2){let t=c().$implicit;_("disabled",t.numeroUsuariosActivos&&t.numeroUsuariosActivos>0)}}function _t(o,e){if(o&1){let t=h();a(0,"button",39),u("click",function(){f(t);let l=c().$implicit,d=c(2);return b(d.activarPlan(l))}),a(1,"mat-icon"),r(2,"toggle_on"),i()()}}function ft(o,e){if(o&1&&(a(0,"tr",22)(1,"td",23)(2,"div",24),r(3),i()(),a(4,"td")(5,"span",25),r(6),i()(),a(7,"td"),p(8,pt,4,2,"div",26)(9,gt,2,0,"span",27),i(),a(10,"td")(11,"span",28),r(12),i()(),a(13,"td",29),r(14),i(),a(15,"td",30)(16,"button",31)(17,"mat-icon"),r(18,"visibility"),i()(),a(19,"button",32)(20,"mat-icon"),r(21,"restaurant_menu"),i()(),a(22,"button",33)(23,"mat-icon"),r(24,"edit"),i()(),p(25,ut,3,1,"button",34)(26,_t,3,0,"button",35),i()()),o&2){let t=e.$implicit,n=c(2);P("inactive",!t.activo),s(3),x(t.nombre),s(3),C("",t.duracionDias," Semanas"),s(2),g(t.objetivo?8:9),s(3),P("active",t.activo)("inactive",!t.activo),s(),C(" ",t.activo?"Activo":"Inactivo"," "),s(2),C(" ",n.formatearFecha(t.createdAt)," "),s(2),_("routerLink",M(15,ot,t.id)),s(3),_("routerLink",M(17,rt,t.id)),s(3),_("routerLink",M(19,lt,t.id)),s(3),g(t.activo?25:26)}}function bt(o,e){if(o&1&&(a(0,"span",40),r(1),i()),o&2){let t=c().$implicit;s(),x(t)}}function Ct(o,e){if(o&1){let t=h();a(0,"button",42),u("click",function(){f(t);let l=c().$implicit,d=c(2);return b(d.irAPagina(d.Number(l)-1))}),r(1),i()}if(o&2){let t=c().$implicit,n=c(2);P("active",t===n.paginaActual()+1),s(),C(" ",t," ")}}function vt(o,e){if(o&1&&p(0,bt,2,1,"span",40)(1,Ct,2,3,"button",41),o&2){let t=e.$implicit;g(t==="..."?0:1)}}function ht(o,e){if(o&1){let t=h();a(0,"div",15)(1,"table",16)(2,"thead")(3,"tr")(4,"th"),r(5,"Nombre del Plan"),i(),a(6,"th"),r(7,"Duraci\xF3n"),i(),a(8,"th"),r(9,"Objetivo"),i(),a(10,"th"),r(11,"Estado"),i(),a(12,"th"),r(13,"Fecha de Creaci\xF3n"),i(),L(14,"th",17),i()(),a(15,"tbody"),S(16,ft,27,21,"tr",18,st),i()()(),a(18,"div",19)(19,"button",20),u("click",function(){f(t);let l=c();return b(l.paginaAnterior())}),a(20,"mat-icon"),r(21,"chevron_left"),i(),r(22," Anterior "),i(),a(23,"div",21),S(24,vt,2,1,null,null,A),i(),a(26,"button",20),u("click",function(){f(t);let l=c();return b(l.paginaSiguiente())}),r(27," Siguiente "),a(28,"mat-icon"),r(29,"chevron_right"),i()()()}if(o&2){let t=c();s(16),O(t.planesFiltrados()),s(3),_("disabled",t.paginaActual()===0),s(5),O(t.paginasVisibles()),s(2),_("disabled",t.paginaActual()>=t.totalPaginas()-1)}}var at=class o{constructor(e,t,n,l){this.planService=e;this.notificationService=t;this.router=n;this.mockData=l}loading=m(!1);mostrarInactivos=m(!1);filtroNombre=m("");planesFiltrados=m([]);filtrosActivos=m([]);paginaActual=m(0);totalPaginas=m(1);tama\u00F1oPagina=20;Number=Number;ngOnInit(){this.cargarPlanes()}toggleFiltros(){this.mostrarInactivos.update(e=>!e),this.mostrarInactivos()?this.filtrosActivos.set(["Mostrar inactivos"]):this.filtrosActivos.set([]),this.cargarPlanes()}removerFiltro(e){this.filtrosActivos.update(t=>t.filter(n=>n!==e)),e==="Mostrar inactivos"&&(this.mostrarInactivos.set(!1),this.cargarPlanes())}paginaAnterior(){this.paginaActual()>0&&(this.paginaActual.update(e=>e-1),this.cargarPlanes())}paginaSiguiente(){this.paginaActual()<this.totalPaginas()-1&&(this.paginaActual.update(e=>e+1),this.cargarPlanes())}irAPagina(e){this.paginaActual.set(e),this.cargarPlanes()}paginasVisibles(){let e=this.totalPaginas(),t=this.paginaActual()+1,n=[];if(e<=7)for(let l=1;l<=e;l++)n.push(l);else{n.push(1),t>3&&n.push("...");for(let l=Math.max(2,t-1);l<=Math.min(e-1,t+1);l++)n.push(l);t<e-2&&n.push("..."),e>1&&n.push(e)}return n}formatearFecha(e){return e?new Date(e).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"-"}cargarPlanes(){this.loading.set(!0),this.planesFiltrados.set(this.mockData.planesDisponibles()),this.totalPaginas.set(1),this.loading.set(!1),(this.mostrarInactivos()?this.planService.obtenerPlanes(this.paginaActual(),this.tama\u00F1oPagina):this.planService.obtenerPlanesActivos(this.paginaActual(),this.tama\u00F1oPagina)).subscribe({next:t=>{if(t.success&&t.data){this.planesFiltrados.set(this.planService.planes());let n=this.planService.totalElements();this.totalPaginas.set(Math.ceil(n/this.tama\u00F1oPagina))}},error:()=>{}})}filtrarPlanes(){let e=this.filtroNombre().trim();if(!e){this.paginaActual.set(0),this.cargarPlanes();return}this.loading.set(!0),this.planService.buscarPlanes(e,this.paginaActual(),this.tama\u00F1oPagina).subscribe({next:t=>{if(this.loading.set(!1),t.success&&t.data){this.planesFiltrados.set(this.planService.planes());let n=this.planService.totalElements();this.totalPaginas.set(Math.ceil(n/this.tama\u00F1oPagina))}},error:()=>{this.loading.set(!1),this.notificationService.showError("Error al buscar planes")}})}confirmarDesactivar(e){confirm(`\xBFEst\xE1s seguro de desactivar el plan "${e.nombre}"?

El plan quedar\xE1 inactivo pero podr\xE1s reactivarlo m\xE1s tarde.`)&&this.planService.desactivarPlan(e.id).subscribe({next:n=>{n.success&&(this.notificationService.showSuccess("Plan desactivado exitosamente"),this.cargarPlanes())},error:n=>{console.log("Error completo:",n),console.log("Error.error:",n.error),console.log("Mensaje:",n.error?.message);let l=n.error?.message||n.error?.error||n.message||"";n.status===409||n.status===400?l||(l="El plan tiene usuarios activos y no puede ser desactivado"):n.status===404?l||(l="Plan no encontrado"):l||(l="Error al desactivar el plan"),this.notificationService.showError(l)}})}activarPlan(e){e&&this.planService.activarPlan(e.id).subscribe({next:t=>{t.success&&(this.notificationService.showSuccess("Plan activado exitosamente"),this.cargarPlanes())},error:t=>{let n=t.error?.message||t.error?.error||t.message||"Error al activar el plan";this.notificationService.showError(n)}})}formatearObjetivo(e){return e?{PERDER_PESO:"P\xE9rdida de Peso",GANAR_MASA_MUSCULAR:"Ganancia Muscular",MANTENER_FORMA:"Mantenimiento",REHABILITACION:"Rehabilitaci\xF3n",CONTROLAR_ESTRES:"Control de Estr\xE9s",SALUD_GENERAL:"Salud General"}[e]||e:"Sin objetivo"}static \u0275fac=function(t){return new(t||o)(v(tt),v(U),v(I),v(q))};static \u0275cmp=w({type:o,selectors:[["app-lista-planes"]],decls:27,vars:5,consts:[[1,"page-container"],[1,"page-header"],[1,"header-content"],[1,"page-title"],[1,"page-subtitle"],["mat-raised-button","","color","primary","routerLink","/admin/planes/crear"],[1,"filters-card"],[1,"filters"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Buscar por nombre...",3,"ngModelChange","ngModel"],["matPrefix",""],[3,"ngModelChange","ngModel"],[1,"loading-state"],[1,"empty-state"],[1,"empty-icon"],[1,"table-container"],[1,"plans-table"],[1,"actions-column"],[1,"plan-row",3,"inactive"],[1,"pagination"],[1,"btn-pagination",3,"click","disabled"],[1,"page-numbers"],[1,"plan-row"],[1,"plan-name-cell"],[1,"plan-name"],[1,"duration-badge"],[1,"objetivo-info"],[1,"text-muted"],[1,"status-badge"],[1,"date-cell"],[1,"actions-cell"],["title","Ver detalles",1,"btn-icon",3,"routerLink"],["title","Gestionar comidas",1,"btn-icon","btn-comidas",3,"routerLink"],["title","Editar",1,"btn-icon",3,"routerLink"],["title","Desactivar plan",1,"btn-icon","btn-delete",3,"disabled"],["title","Activar plan",1,"btn-icon","btn-success"],[1,"objetivo-calorias"],[1,"objetivo-desc"],["title","Desactivar plan",1,"btn-icon","btn-delete",3,"click","disabled"],["title","Activar plan",1,"btn-icon","btn-success",3,"click"],[1,"page-ellipsis"],[1,"page-number",3,"active"],[1,"page-number",3,"click"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"mat-icon"),r(5,"restaurant_menu"),i(),r(6," Gesti\xF3n de Planes Nutricionales "),i(),a(7,"p",4),r(8,"Crea, edita y gestiona todos los planes nutricionales desde aqu\xED."),i()(),a(9,"button",5)(10,"mat-icon"),r(11,"add"),i(),r(12," Crear Nuevo Plan "),i()(),a(13,"mat-card",6)(14,"mat-card-content")(15,"div",7)(16,"mat-form-field",8)(17,"mat-label"),r(18,"Buscar planes"),i(),a(19,"input",9),k("ngModelChange",function(d){return y(n.filtroNombre,d)||(n.filtroNombre=d),d}),u("ngModelChange",function(){return n.filtrarPlanes()}),i(),a(20,"mat-icon",10),r(21,"search"),i()(),a(22,"mat-checkbox",11),k("ngModelChange",function(d){return y(n.mostrarInactivos,d)||(n.mostrarInactivos=d),d}),u("ngModelChange",function(){return n.cargarPlanes()}),r(23," Mostrar planes inactivos "),i()()()(),p(24,ct,5,0,"div",12),p(25,dt,13,0,"mat-card"),p(26,ht,30,2),i()),t&2&&(s(19),E("ngModel",n.filtroNombre),s(3),E("ngModel",n.mostrarInactivos),s(2),g(n.loading()?24:-1),s(),g(!n.loading()&&n.planesFiltrados().length===0?25:-1),s(),g(!n.loading()&&n.planesFiltrados().length>0?26:-1))},dependencies:[F,N,$,V,z,B,K,H,J,R,T,D,j,it,nt,Y,Q,X,et,W,G,Z],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem;max-width:1400px;margin:0 auto;background:#f5f5f5;min-height:100vh}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem}.header-content[_ngcontent-%COMP%]{flex:1}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin:0 0 .5rem;font-size:2rem;color:#333}.page-title[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:2rem;width:2rem;height:2rem;color:var(--primary-color, #00A859)}.page-subtitle[_ngcontent-%COMP%]{margin:0;color:#666;font-size:1rem}.filters-card[_ngcontent-%COMP%]{margin-bottom:2rem}.filters[_ngcontent-%COMP%]{display:flex;gap:1.5rem;align-items:center;flex-wrap:wrap}.search-field[_ngcontent-%COMP%]{flex:1;min-width:300px}mat-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer}.table-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px #0000001a;border:1px solid #e2e8f0}.plans-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.plans-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:#f8f9fa;border-bottom:2px solid #e2e8f0}.plans-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem 1.5rem;text-align:left;font-size:.75rem;font-weight:600;color:#6c757d;text-transform:uppercase;letter-spacing:.05em}.plans-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #e2e8f0;transition:background .15s}.plans-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8f9fa}.plans-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child{border-bottom:none}.plans-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.inactive[_ngcontent-%COMP%]{opacity:.6}.plans-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem 1.5rem;font-size:.875rem;color:#212529}.plan-name-cell[_ngcontent-%COMP%]{font-weight:500}.plan-name[_ngcontent-%COMP%]{color:#2d3748;font-size:.95rem}.duration-badge[_ngcontent-%COMP%]{padding:.375rem .875rem;background:#edf2f7;color:#2d3748;border-radius:6px;font-size:.875rem;white-space:nowrap}.objetivo-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.objetivo-calorias[_ngcontent-%COMP%]{font-weight:600;color:#00a859;font-size:.9rem}.objetivo-desc[_ngcontent-%COMP%]{font-size:.75rem;color:#718096;font-style:italic}.text-muted[_ngcontent-%COMP%]{color:#718096;font-style:italic}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:.375rem .875rem;border-radius:16px;font-size:.8125rem;font-weight:500}.status-badge.active[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-badge.inactive[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.date-cell[_ngcontent-%COMP%]{color:#718096}.actions-cell[_ngcontent-%COMP%]{text-align:right}.actions-column[_ngcontent-%COMP%]{text-align:right;width:150px}.btn-icon[_ngcontent-%COMP%]{background:transparent;border:none;color:#718096;cursor:pointer;padding:.5rem;border-radius:6px;transition:all .2s;margin-left:.25rem}.btn-icon[_ngcontent-%COMP%]:hover{background:#edf2f7;color:#2d3748}.btn-icon.btn-delete[_ngcontent-%COMP%]:hover{background:#fff5f5;color:#e53e3e}.btn-icon.btn-success[_ngcontent-%COMP%]{color:#38a169}.btn-icon.btn-success[_ngcontent-%COMP%]:hover{background:#f0fff4;color:#38a169}.btn-icon[_ngcontent-%COMP%]:disabled{opacity:.3;cursor:not-allowed}.btn-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:.5rem;margin-top:2rem;padding:1rem}.btn-pagination[_ngcontent-%COMP%]{min-width:2.5rem;height:2.5rem;display:flex;align-items:center;justify-content:center;padding:0 .75rem;background:#fff;color:#00a859;border:1px solid #dee2e6;border-radius:4px;cursor:pointer;transition:all .2s;font-size:.875rem;font-weight:500;gap:.25rem}.btn-pagination[_ngcontent-%COMP%]:hover:not(:disabled){background:#00a859;color:#fff;border-color:#00a859}.btn-pagination[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;color:#6c757d;background:#f8f9fa}.page-numbers[_ngcontent-%COMP%]{display:flex;gap:.25rem;align-items:center}.page-number[_ngcontent-%COMP%]{min-width:2.5rem;height:2.5rem;display:flex;align-items:center;justify-content:center;background:#fff;color:#00a859;border:1px solid #dee2e6;border-radius:4px;cursor:pointer;transition:all .2s;font-size:.875rem;font-weight:500}.page-number[_ngcontent-%COMP%]:hover, .page-number.active[_ngcontent-%COMP%]{background:#00a859;color:#fff;border-color:#00a859}.page-ellipsis[_ngcontent-%COMP%]{color:#6c757d;padding:0 .25rem;font-weight:500}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:4rem;color:#718096}.loading-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem;margin-bottom:1rem;color:#00a859;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;width:4rem;height:4rem;color:#ccc;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#333}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;margin-bottom:1.5rem}"]})};export{at as ListaPlanesComponent};
